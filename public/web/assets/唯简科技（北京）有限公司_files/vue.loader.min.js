var VueLoader=new function(){var e=document,t=this;this.debug=function(e){return window.VueLoaderDebug&&window.VueLoaderDebug(e)},Vue.config.errorHandler=function(e,t){console.log("error "+e.message+"\r\n"+e.stack)},Vue.mixin({beforeMount:function(){this.vcname=this.constructor.options.name,this._orender||(this._orender=this._render,this._render=function(){var e=this._orender.apply(this,arguments),t=this.vcname;if(t&&e){var n=e.parent,r=n&&n.data||{},a=r&&r.attrs||{},i=e.data;i||(e.data=i={}),i.attrs||(i.attrs={});var s=r.class||{},o=i.class;if(o||(i.class=o={}),i.staticClass){for(var c=i.staticClass.split(/\s+/),l=0;l<c.length;l++)o[c[l].trim()]=!0;i.staticClass=""}o[t]=!s[t];var d=i.ovaInheritSkin=i.attrs.skin||i.ovaInheritSkin||a.skin||r.ovaInheritSkin;if(d&&(o[d+"-"+t]=!s[d+"-"+t]),"ovo-"==t.substring(0,4)){var h=i.ovaInheritScene=i.attrs.scene||i.ovaInheritScene||a.scene||r.ovaInheritScene;if(h&&"ovo"!=h){var u=h+"-"+t.substring(4);o[u]=!s[u],d&&(o[d+"-"+u]=!s[d+"-"+u])}}}return e})}});var n=function(e,t,n){var r=e.indexOf(t),a=r>=0?e.indexOf(n,r):-1;return r>=0&&a>=r?e.substring(r+t.length,a).trim():""},r=function(e,t){for(var n=0,r="<"+t,a="</"+t+">",i=[];n<e.length;){var s=e.indexOf(r,n),o=(s=s>=0?e.indexOf(">",s):-1)>=0?e.indexOf(a,s):-1,n=o>=0?o+a.length:e.length+1,c=s>=0&&o>=s?e.substring(s+1,o).trim():"";c&&i.push(c)}return i},a=function(e,t,r){var a=new RegExp(r+"\\s*=\\s*([\\'\\\"])([^\\1]*)\\1"),i=n(e,"<"+t,">");return(i=i.match(a))&&i.length>2&&i[2]&&i[2].trim()||""};this.addCSS=function(t){var n=e.createElement("style");n.setAttribute("type","text/css"),n.styleSheet&&(n.styleSheet.cssText=t)||n.appendChild(e.createTextNode(t)),e.getElementsByTagName("head")[0].appendChild(n)},this.addJS=function(t){var n=e.createElement("script");n.appendChild(e.createTextNode(t)),e.getElementsByTagName("head")[0].appendChild(n)},this.parseVC=function(e,n){var s=[];if(n){var o=r(n,"code");0==o.length&&(o=[n]);for(var c=!1,l=0;l<o.length;l++){var d=o[l];if(d)try{var h=r(d,"style")[0];h&&(this.debug("style:"+h),this.addCSS(h));var u=r(d,"template")[0],f=a(d,"script","id"),v=r(d,"script")[0];v||u||h||(v=d),u&&(v=v.replace(/\{/,"{\r\ntemplate:'"+u.replace(/'/g,"\\'").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"',")),v="/*** "+e+" ***/\r\nVue.component('"+f+"', "+v+");",this.debug("script:"+v),this.addJS(v),s.push(f),c=c||i.vcs&&i.cb&&i.vcs.indexOf(f)>=0}catch(t){console.log(e+" parseVC Error: "+t.message)}}c&&t.onloaded(i.vcs,i.cb)}return s},this.url_load=null,this.cb_done=null,this.done=function(e){if(this.url_load)this.cb_done=e;else if(e)return e();return this},this.loadOne=function(e,n){return n?(t.debug("异步加载 "+e),t.url_load=e,$.ajax({url:e,mimeType:"text/plain",cache:!1}).done(function(r){t.parseVC(e,r),n&&n(),t.cb_done&&t.cb_done()})):(t.debug("同步加载 "+e),t.url_load=null,t.parseVC(e,$.ajax({url:e,mimeType:"text/plain",async:!1,cache:!1}).responseText)),t},this.loadVC=function(e,n){if("string"==$.type(e))t.loadOne(e,n);else if(n){var r=0,a=function(){r<e.length?(t.loadOne(e[r],a),r++):n()};a()}else for(var i=0;i<e.length;i++)t.loadOne(e[i]);return t},this.loadVCLink=function(){for(var n=e.getElementsByTagName("link"),r=0;r<n.length;r++)"vc"!=n[r].rel||n[r].loaded||(n[r].loaded=!0,t.loadVC(n[r].href,"async"==n[r].type?function(){}:void 0))};var i={};this.onloaded=function(e,t){for(var n=!0,r=0;n&&r<e.length;r++)n=!!Vue.component(e[r]);n&&t?(t(),i={}):i={vcs:e,cb:t}};var s=[];return e.onreadystatechange=function(e){for(var t=0;t<s.length;t++)s[t](e)},e.__defineSetter__("onreadystatechange",function(e){s.push(e)}),e.onreadystatechange=function(){"interactive"==e.readyState&&t.loadVCLink()},this};