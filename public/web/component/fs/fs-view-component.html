<code>

	<style scoped>
		/*----------  style  ----------*/
		.fs-view-component .fs-node-highlight {
			-webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
			-moz-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
			box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
		}

		.fs-view-component .fs-node-selected {
			-webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
			-moz-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
            box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
        }
        
        .fs-view-component .fs-node-selected::before {
            content: '\2713 ';
            font-size: 16px;
            font-weight: 600;
            color: rgba(37, 45, 73, 0.5);
            position: absolute;
            bottom: 5px;
            right: 5px;
        }

		.fs-view-component .fs-footer{
			position:fixed;
			bottom:30px;
		}

		.editable-click, a.editable-click, a.editable-click:hover {
			border-bottom: none;
		}

		.fs-view-component .fa-bars {
			color: rgb(144, 144, 144);
		}

		/* For note-view */
		#note {
			padding-left:0px;
			flex-flow: nowrap;
			display: flex;
			flex-direction: column;
		}

		#note ul{
			padding-left: 0;
			list-style: none;
		}

		#note ul > li{
			width: 20em;
			float: left;
			height: 250px;
			padding: 5px;
			font-size: 10px;
			line-height: 1;
			text-align: center;
		}

		#note .bg-silver {
			background: rgb(255, 255, 255) !important;
			border: 1px solid rgb(221, 221, 221);
		}

		#note .widget-stats.bg-silver .stats-link a{
			background: rgb(249, 249, 249);
		}

		#note .tags{
			border: none;
		}

		#note .fs-name i {
			color: rgb(153, 153, 153);
		}

		/* For list-view */
		#list {
			padding-left:0px;
			flex-flow: nowrap;
			display: flex;
			flex-direction: column;
		}

		#list ul{
			padding-left: 0;
			list-style: none;
		}

		#list ul > li{
			width: 20em;
			float: left;
			height: 250px;
			padding: 5px;
			font-size: 10px;
			line-height: 1;
			text-align: center;
		}

		#list .bg-silver {
			background: rgb(255, 255, 255) !important;
			border: 1px solid rgb(221, 221, 221);
		}

		#list .widget-stats.bg-silver .stats-link a{
			background: rgb(249, 249, 249);
		}

		#list .tags{
			border: none;
		}

		#list .fs-name i {
			color: rgb(153, 153, 153);
		}


		/* For grid-view */
		#grid ul{
			padding-left: 0;
			list-style: none;
		}

		#grid ul > li{
			float: left;
			width: 10em;
			height: 105px;
			font-size: 10px;
			line-height: 1.4;
			text-align: center;
			background-color: rgb(249, 249, 249);
			border: 1px solid rgb(255, 255, 255);
			margin: 5px 5px 0px 0px;
		}


		#fs-deploy-icon-list ul,
		#icon-list ul{
			padding-left: 0;
			list-style: none;
		}

		#fs-deploy-icon-list ul > li,
		#icon-list ul > li{
			float: left;
			width: 7.3em;
			height: 115px;
			padding: 10px;
			font-size: 10px;
			line-height: 1.4;
			text-align: center;
			background-color: rgb(249, 249, 249);
			border: 1px solid rgb(255, 255, 255);
		}

		.media-object {
			width: 48px;
			height: 48px;
		}

		/*
		*   File Upload
		*/
		.progress {
			height: 18px;
			border-radius: 0px;
			display: block;
			position: relative;
			bottom: 16px;
		}

		.progress small {
			color: #444444;
			width: 100%;
			position: absolute;
			z-index: 10;
			top: 0;
			left: 0;
		}

		#files ul{
			margin: 10px;
			padding-left: 0;
			list-style: none;
		}

		#files ul > li{
			float: left;
			width: 100pt;
			height: 100px;
			font-size: 12px;
			line-height: 1.4;
			text-align: center;
			background-color: rgb(249, 249, 249);
			border: 1px solid rgb(255, 255, 255);
			padding-top: 5px;
			margin: 5px 0px 20px 5px;
		}

		#files ul > li > canvas {
			height: 65%;
			width: auto;
		}

		#files ul > li > a {
			background-color: rgb(249, 249, 249);
			border-radius: 0px;
		}

		#files ul > li > button {
			margin-top: -50px;
		}

		#files ul > li > .preview-null {
			width: 100px;
			padding-top: 10px;
			height: 64px;
			color: rgb(221, 221, 221);
		}

		.preview-img-responsive{
			max-width: 100%;
			height: auto;
			display: block;
		}

		.fs-view-component #grid,
		.fs-view-component .dataTables_scroll{
			height: 75vh;
			overflow: auto;
			padding: 0 10px;
		}

		.fs-name {
			text-overflow: ellipsis;
			overflow: hidden;
			white-space: nowrap;
		}


		/* For layout */
		.lm_goldenlayout {
			background: none;
			background-color: rgb(246, 246, 246)!important;
		}

		.lm_content {
			background: rgb(255, 255, 255);
			border: none!important;
			overflow: hidden;
			padding: 0px!important;
		}

		.lm_header{
			height: 26px!important;
		}

		.lm_header .lm_tab {
			border: none;
			height: 15px;
		}

		.lm_tab {
			height: 18px !important;
			line-height:20px;
		}

		.lm_close_tab {
			height: 16px !important;
		}

		.lm_controls {
			top:5px;
		}

		.lm_header .lm_tab.lm_active {
			border-bottom: none;
			box-shadow: none;
			padding-bottom: 6px;
			border-bottom: 1px solid rgb(255, 0, 0);
			background-color: rgb(246, 246, 246);
		}

		.lm_tab:hover, .lm_tab.lm_active {
			background: rgb(255, 255, 255);
			color: rgb(119, 119, 119);
		}


		.lm_selected .lm_header {
			background-color: rgb(230, 230, 230);
		}

		.lm_splitter {
			background: rgb(153, 153, 153);
			z-index: 1;
		}

		.lm_tabs > li[title=编辑] .lm_close_tab,
		.lm_tabs > li[title=结果] .lm_close_tab,
		.lm_tabs > li[title=预览] .lm_close_tab {
			display:none;
		}


		/* For view-container */
		.note-view,
		.list-view,
		.grid-view,
		.table-view{
			overflow: auto;
			height: 70vh;
		}

	</style>

	
	/*----------  最外层element会自动增加组件同名 class="fs-view-component"  ----------*/
	<template>

		<div class="container-fluid">
			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<ul style="list-style: none;display:  flex;padding:0 8px;">
						<li style="padding:5px 0px;">
							<a href="javascript:void(0);" @click="openIt(null,'/')" style="text-decoration:none;color:#333333;"><i class="fa fa-folder-o"></i> ${rootName} </a>
						</li>
						<li>
							<ol class="breadcrumb">
								<li v-for="(item,index) in filePath" >
									<a href="javascript:void(0);" @click="openIt(item,_.slice(filePath,0,index+1).join('/'))" :title="_.slice(filePath,0,index+1).join('/')">${item}</a>
								</li>
							</ol>
						</li>
					</ul>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<div class="btn-group" style="padding:0 11px;float:right;">

                        <el-tooltip content="刷新" placement="top">
                            <a href="#" class="btn btn-link" @click="load" title="刷新">
                                <i class="fas fa-sync-alt"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="排序" placement="top">
                            <a href="#" class="btn btn-link fs-order" title="排序">
                                <i class="fas fa-list-ol"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="新建目录" placement="top">
                            <a href="#" class="btn btn-link" @click="newDir" title="新建目录">
                                <i class="fas fa-folder-plus"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="新建文件" placement="top">
                            <a href="#" class="btn btn-link" @click="newFile" title="新建文件">
                                <i class="fas fa-file"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="选择所有" placement="top">
                            <a href="#" class="btn btn-link" @click="selectAll" title="选择所有">
                                <i class="fas fa-check-square"></i>
                            </a>
                        </el-tooltip>
                        
                        <el-tooltip content="复制" placement="top">
                            <a href="#" class="btn btn-link" @click="copyThem" title="复制">
                                <i class="fas fa-copy"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="粘贴到" placement="top">
                            <a href="#" class="btn btn-link" @click="pasteIt" title="粘贴到">
                                <i class="fas fa-paste"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="移动到" placement="top">
                            <a href="#" class="btn btn-link" @click="moveIt" title="移动到">
                                <i class="fas fa-people-carry"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="删除" placement="top">
                            <a href="#" class="btn btn-link" @click="deleteThem" title="删除">
                                <i class="fas fa-trash"></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="上传文件" placement="top">
                            <a href="javascript:void(0);" class="btn btn-link fileinput-button" title="上传文件" style="color:#16e216;">
                                <i class="fas fa-upload"></i>
                                <input id="file-upload" type="file" name="uploadfile" multiple>
                            </a>
                        </el-tooltip>
						<!--<a href="#" class="btn btn-link" @click="downloadThem" title="下载文件，可选择多个文件">
							<i class="fas fa-download""></i>
						</a>-->
						<!-- <a href="#" class="btn btn-link" @click="toggleView('grid-view')" title="图标显示" data-tooltip="tooltip">
							<i class="fas fa-th"></i>
						</a>
						<a href="#" class="btn btn-link" @click="toggleView('table-view')" title="列表显示" data-tooltip="tooltip">
							<i class="fas fa-bars"></i>
                        </a> -->
                        <el-tooltip content="导出备份" placement="top">
                            <a href="#" class="btn btn-link" @click="exportIt(rootPath)" title="导出备份">
                                <i class="fas fa-cloud-download-alt""></i>
                            </a>
                        </el-tooltip>

                        <el-tooltip content="导入恢复" placement="top">
                            <a href="javascript:void(0);" class="btn btn-link fileinput-button" title="导入恢复">
                                <i class="fas fa-cloud-upload-alt" style=""></i>
                                <input type="file" name="loadfile" multiple @change="importIt">
                            </a>
                        </el-tooltip>

                        <el-tooltip content="版本同步" placement="top">
                            <a href="#" class="btn btn-link" @click="syncIt" title="版本同步">
                                <i class="fas fa-retweet""></i>
                            </a>
                        </el-tooltip>

					</div>
				</div>
			</div>
			<div class="row">

				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" id="view-container" @dblclick="resetStatus">
					<component v-bind:is="currentView" :model.sync="model"></component>
				</div>

			</div>
			<div class="row fs-footer">
	            <div class="col-lg-12">
		            <small>数量：${model.length}  | 已选中：${selectedItem.length} </small>
	            </div>
			</div>
		</div>

	</template>

	/*----------  id是vue组件的name，内容是vue组件的option参数  ----------*/
	<script id="fs-view-component">
	{
        delimiters: ['${', '}'],
		props: {
			id: String,
            root: String,
            rootName: String,
            defaultView: String
		},
		data: function () {

            Vue.component('note-view',{
                delimiters: ['#{', '}#'],
                props: {
                    model: Array
                },
                template: `<div id="note">
							   <ul>
								  <li :class="item.ftype=='dir'?'dir fs-node context-menu-file':'fs-node context-menu-file'"
								       :id="'fs_node_'+item.id"
								       @mouseover="$parent.mouseOver(item)"
								       @mouseout="$parent.mouseOut(item)"
								       style="cursor: pointer;"
								       :title="item.name"
								       v-for="item in model">
									  <div class="widget widget-stats bg-silver animated flipInX" :id="'fs_node_widget_'+item.id" @click="$parent.selectIt(item)" @dblclick="$parent.openIt(item, item.parent+'/'+item.name);">
										  <div class="stats-info">
											  <p><img class="media-object" :src="item | pickIcon" onerror="this.src='${window.ASSETS_ICON}files/png/dir.png?type=open&issys=${window.SignedUser_IsAdmin}';"></p>
										  </div>
										  <div class="stats-link">
											  <a class="fs-name" :data-pk="item.id" href="javascript:void(0);" style="text-align: left;margin:15px -15px -15px -15px;padding: 10px;" :title="item.title" :data-info="JSON.stringify(item)">
												  <p style="margin: 0 0 8.5px;"><i class="fas fa-plug"></i>  名称：#{item.name}#</p>
												  <p style="margin: 0 0 8.5px;"><i class="fas fa-user"></i>  作者：#{item|pickAuthor}# </p>
												  <p style="margin: 0 0 8.5px;"><i class="fas fa-clock"></i> 创建：#{moment(item.vtime).format("YYYY-MM-DD hh:mm:ss")}# </p>
												  <!--<p><i class="fas fa-tree"></i>  类型：#{item.ftype=='dir'?'目录':item.ftype}#</p>-->
												  <p style="margin: 0 0 8.5px;"><i class="fas fa-tags"></i>  标签：<input type="text" class="tags" name="tags" :value="item|pickTags"></p>
												  <p style="margin: 0 0 8.5px;"><i class="fab fa-readme"></i>  描述：#{item|pickRemark}#</p>
											  </a>
										  </div>
										  <div class="list-context-menu" :data-item="JSON.stringify(item)" style="position: absolute;right: 10px;top: 5px;cursor:pointer;">
											  <i class="fa fa-bars"></i>
										  </div>
									  </div>
								  </li>
							  </ul></div>`,
                data:function(){
                    return {}
                },
                filters: {
                    pickName: function(item){

                        if (_.isEmpty(item)) return '';

                        let _name = _.head(item.name.split("."));

                        if(!_.isEmpty(_name)){
                            _name = _.truncate(_name, {
                                'length': 9
                            });
                        }

                        return _name;
                    },
                    pickIcon: function(item){

                        // extend || ...
                        if( item.fullname === '/extend' ){
                            return `${window.ASSETS_ICON}/files/png/dir-lock.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                        } else {

                            try{
                                return _.attempt(JSON.parse.bind(null, item.attr)).icon || `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            }
                            catch(error){
                                return `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            }
                        }

                    },
                    pickTags: function(item){

                        if(item.tags){
                            return item.tags.join(",");
                        } else {
                            return "";
                        }
                    },
                    pickAuthor: function(item){
                        if (!_.isEmpty(item.attr) && !_.isEqual(item.attr, 'null')) {
                            return _.attempt(JSON.parse.bind(null, item.attr)).author;
                        } else {
                            return "";
                        }
                    },
                    pickRemark: function(item){
                        if (!_.isEmpty(item.attr) && !_.isEqual(item.attr, 'null')) {
                            return _.attempt(JSON.parse.bind(null, item.attr)).remark;
                        } else {
                            return "";
                        }
                    }
                },
                watch:{
                    model:{
                        handler:function(val,oldVal){
                            let me = this;

                            let _tagify = $('input[name=tags]').data("tagify");

                            _tagify.removeAllTags.bind(_tagify);
                            me.init();

                        },
                        deep:true
                    }
                },
                mounted: function(){

                    let me = this;

                    me.init();

                },
                methods: {
                    init:function(){
                        let me = this;

                        // init Tagify script on the above inputs
                        $('input[name=tags]').tagify()
                            .on('add', me.onAddTag)
                            .on('remove', me.onRemoveTag);
                    },
                    onAddTag: function(event,tagName){
                        let me = this;

                        let item = $(event.currentTarget).parent().parent().data("info");

                        let input = {class: item.class, action: "+", tag: tagName.value, id: item.id};
                        let rtn = fsHandler.callFsJScript('/tags/tag_service.js', encodeURIComponent(JSON.stringify(input)));

                        if(rtn.status == 'ok'){
                            me.$parent.init();
                        }

                    },
                    onRemoveTag: function(event,tagName){
                        let me = this;
                        let item = $(event.currentTarget).parent().parent().data("info");
                        let input = {class: item.class, action: "-", tag: tagName.value, id: item.id};
                        let rtn = fsHandler.callFsJScript('/tags/tag_service.js', encodeURIComponent(JSON.stringify(input)));

                        if(rtn.status == 'ok'){
                            me.$parent.init();
                        }

                    }

                }
            });

            Vue.component('list-view',{
                delimiters: ['#{', '}#'],
                props: {
                    model: Array
                },
                template: `<div id="list">
							   <ul>
								  <li :class="item.ftype=='dir'?'dir fs-node context-menu-file':'fs-node context-menu-file'"
								       :id="'fs_node_'+item.id"
								       @mouseover="$parent.mouseOver(item)"
								       @mouseout="$parent.mouseOut(item)"
								       style="cursor: pointer;"
								       :title="item.name"
								       v-for="item in model">
									  <div class="widget widget-stats bg-silver animated flipInX" :id="'fs_node_widget_'+item.id" @click="$parent.selectIt(item)" @dblclick="$parent.openIt(item, item.parent+'/'+item.name);">
										  <div class="stats-info">
											  <p><img class="media-object" :src="item | pickIcon" onerror="this.src='${window.ASSETS_ICON}files/png/dir.png?type=open&issys=${window.SignedUser_IsAdmin}';"></p>
										  </div>
										  <div class="stats-link">
											  <a class="fs-name" :data-pk="item.id" href="javascript:void(0);" style="text-align: left;margin:15px -15px -15px -15px;padding: 10px;" :title="item.title" :data-info="JSON.stringify(item)">
                                                <p style="margin: 0 0 8.5px;"><i class="fas fa-plug"></i>  名称：#{item.name}#</p>
                                                <p style="margin: 0 0 8.5px;"><i class="fas fa-user"></i>  作者：#{item|pickAuthor}# </p>
                                                <p style="margin: 0 0 8.5px;"><i class="fas fa-clock"></i> 创建：#{moment(item.vtime).format("YYYY-MM-DD hh:mm:ss")}# </p>
												<!--<p><i class="fas fa-tree"></i>  类型：#{item.ftype=='dir'?'目录':item.ftype}#</p>-->
												<p style="margin: 0 0 8.5px;"><i class="fas fa-tags"></i>  标签：<input type="text" class="tags" name="tags" :value="item|pickTags"></p>
												<p style="margin: 0 0 8.5px;"><i class="fab fa-readme"></i>  描述：#{item|pickRemark}#</p>
											  </a>
										  </div>
										  <div class="list-context-menu" :data-item="JSON.stringify(item)" style="position: absolute;right: 10px;top: 5px;cursor:pointer;">
											  <i class="fa fa-bars"></i>
										  </div>
									  </div>
								  </li>
							  </ul></div>`,
	            data:function(){
                    return {}
	            },
	            filters: {
                    pickName: function(item){

                        if (_.isEmpty(item)) return '';

                        let _name = _.head(item.name.split("."));

                        if(!_.isEmpty(_name)){
                            _name = _.truncate(_name, {
                                'length': 9
                            });
                        }

                        return _name;
                    },
                    pickIcon: function(item){
                        // extend || ...
                        if( item.fullname === '/extend' ){
                            return `${window.ASSETS_ICON}/files/png/dir-lock.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                        } else {

                            try {
                                return _.attempt(JSON.parse.bind(null, item.attr)).icon || `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            }
                            catch(error){
                                return `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            }
                        }

                    },
                    pickTags: function(item){

                        if(item.tags){
                            return item.tags.join(",");
                        } else {
                            return "";
                        }
                    },
	                pickAuthor: function(item){
                        if (!_.isEmpty(item.attr) || !_.isEqual(item.attr, 'null')) {
                            return _.attempt(JSON.parse.bind(null, item.attr)).author;
                        }
	                },
                    pickRemark: function(item){
                        if (!_.isEmpty(item.attr) || !_.isEqual(item.attr, 'null')) {
                            return _.attempt(JSON.parse.bind(null, item.attr)).remark;
                        }
                    }
                },
	            watch:{
                  model:{
                      handler:function(val,oldVal){
	                      let me = this;

                          let _tagify = $('input[name=tags]').data("tagify");

                          _tagify.removeAllTags.bind(_tagify);
	                      me.init();

                      },
	                  deep:true
                  }
	            },
                mounted: function(){

                    let me = this;

                    me.init();

                },
                methods: {
                    init:function(){
                        let me = this;

                        // init Tagify script on the above inputs
                        $('input[name=tags]').tagify()
	                              .on('add', me.onAddTag)
	                              .on('remove', me.onRemoveTag);
                    },
                    onAddTag: function(event,tagName){
                        let me = this;

                        let item = $(event.currentTarget).parent().parent().data("info");

	                    let input = {class: item.class, action: "+", tag: tagName.value, id: item.id};
                        let rtn = fsHandler.callFsJScript('/tags/tag_service.js', encodeURIComponent(JSON.stringify(input)));

                        if(rtn.status == 'ok'){
                            me.$parent.init();
                        }

                    },
                    onRemoveTag: function(event,tagName){
                        let me = this;
                        let item = $(event.currentTarget).parent().parent().data("info");
                        let input = {class: item.class, action: "-", tag: tagName.value, id: item.id};
                        let rtn = fsHandler.callFsJScript('/tags/tag_service.js', encodeURIComponent(JSON.stringify(input)));

                        if(rtn.status == 'ok'){
                            me.$parent.init();
                        }

                    }

                }
            });

            Vue.component('grid-view',{
                delimiters: ['#{', '}#'],
                props: {
                    model: Array
                },
                template: `<div id="grid">
							   <ul>
								  <li  :class="item.ftype=='dir'?'dir fs-node context-menu-file':'fs-node context-menu-file'"
								       :id="'fs_node_'+item.id"
								       @mouseover="$parent.mouseOver(item)"
								       @mouseout="$parent.mouseOut(item)"
								       style="cursor: pointer;"
								       :title="item.name"
								       v-for="item in model">
									  <div class="widget widget-stats bg-silver animated flipInX" :id="'fs_node_widget_'+item.id" @click="$parent.selectIt(item)" @dblclick="$parent.openIt(item, item.parent+'/'+item.name);" >
										  <div class="stats-info">
											  <p><img class="media-object" :src="item | pickIcon" onerror="this.src='${window.ASSETS_ICON}/files/png/dir.png?type=open&issys=${window.SignedUser_IsAdmin}';"></p>
										  </div>
										  <div class="stats-link">
											  <a class="fs-name" data-edit="true" :data-pk="item.id" href="javascript:void(0);" style="text-align: left;margin:15px -15px -15px -15px;padding: 5px;" :title="item.name" :data-info="JSON.stringify(item)">
												  #{item.name}#
											  </a>
										  </div>
										  <div class="list-context-menu" :data-item="JSON.stringify(item)" style="position: absolute;right: 10px;top: 5px;cursor:pointer;">
											  <i class="fa fa-bars"></i>
										  </div>
									  </div>
								  </li>
							  </ul></div>`,
                filters: {
                    pickName: function(item){

                        if (_.isEmpty(item)) return '';

                        let _name = _.head(item.name.split("."));

                        if(!_.isEmpty(_name)){
                            _name = _.truncate(_name, {
                                'length': 9
                            });
                        }

                        return _name;
                    },
                    pickIcon: function(item){

                        // extend || ...
                        if( item.fullname === '/extend' ){
                            return `${window.ASSETS_ICON}/files/png/dir-lock.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                        } else {
                            try{
                                if(_.includes(['png','jpeg'],item.ftype)){
                                    return `/fs${item.parent}/${item.name}?type=open&issys=${window.SignedUser_IsAdmin}`;    
                                } else {
                                    return _.attempt(JSON.parse.bind(null, item.attr)).icon || `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                            }
                            catch(error){
                                return `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            }
                        }
                    }
                }
            });

            Vue.component('table-view',{
                delimiters: ['#{', '}#'],
                props: {
                    model: Array
                },
                template: `<fs-datatable-component id="files-list-datatable"
					                         :columns="datatable.columns"
					                         :dataset="datatable.dataset"
					                         :options="datatable.options"></fs-datatable-component>`,
                computed: {
                    datatable: function(){

                        let _list = fsHandler.callFsJScript(`/fs/fs_data.js`, '').message;

                        _list.dataset =  this.model;

                        return _list;
                    }
                }
            });

            return {
                rootPath: this.root,
                model: [],
                selectedItem: [],
			    datatable: {},
                upload:{
                    option: {
                        url: '/fs/temp',
                        dataType: 'json',
                        autoUpload: true,
                        acceptFileTypes: /(\.|\/)(gif|jpe?g|png|csv|log|pdf|html|txt|iso|mp3|mp4)$/i,
                        maxFileSize: 999*000,
                        disableImageResize: /Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),
                        previewMaxWidth: 100,
                        previewMaxHeight: 100,
                        previewCrop: true
                    },
                    swal: {}
                },
				action: {
                    from: null,
                    to: null
                },
                signedUserName: '',
                currentView: 'grid-view'
			}
		},
        created: function() {
            const self = this

            self.init();

            eventHub.$on("FS-FORWARD-EVENT", self.openIt);
            eventHub.$on("PATH-CHANGE-EVENT", self.setRootPath);
        },
		mounted: function () {
            const self = this

            self.$nextTick(function () {

                self.initPlugIn();

			})
		},
		watch: {
			root: function(val,oldVal){
			    const self = this

                self.rootPath = val;

                self.load();
			},
            rootPath: function(val,oldVal){
                const self = this

                let _extName = _.split(val,'.');

                if(_extName.length == 1){
                    self.load();
                }

	            let _url = val.replace(/\/\//g,'/');

                // system || extend || ... 判断第一级
	            if(window.SignedUser_IsAdmin){
                    _url += '?issys=true';
	            }

                $('#file-upload').fileupload({url: `/fs${_url}`});

            },
            selectedItem:function(val,oldVal){
			    const self = this

                $(".fs-node-selected").removeClass("fs-node-selected");

                _.forEach(val,function(v){
                    let node = $(`#fs_node_widget_${v.id}`);

                    $(node).addClass("fs-node-selected");
                })
            }
		},
        computed: {
            filePath: function(){
                return this.rootPath.split("/");
            }
        },
		methods: {
			init: function(){
                this.load();
                this.signedUserName = window.SignedUser_UserName;
			},
			initPlugIn: function(){
			    const self = this;

                self.initFileUpload();

                self.initContextMenu();

                if(!_.isEmpty(self.defaultView)){
                    self.currentView = self.defaultView;
                }

                self.orderIt();

                // 非选择区域事件
                // $(document).mouseup(function(e) {
                //     let items = $("li.dir.fs-node");
                //     let exclude = $("div.btn-group > a");
                    
                //     if (!items.is(e.target) && items.has(e.target).length === 0) {
                //         self.selectedItem = [];
                //         window.fsSelectedItem = [];
                //     }
                // });

                // 排他事件
                $('*[data-edit="true"]').click(function(e) {
                    console.log(e)
                    //e.preventDefault();
                    e.stopPropagation();
                });

			},
			toggleView: function(view){
			    const self = this

			    self.currentView = view;
			},
			initContextMenu: function(){
			    const self = this

                $.contextMenu({
                    selector: '.list-context-menu',
                    trigger: 'left',
                    build: function($trigger, e) {
                        
	                    let _item = null;

	                    if(!_.isEmpty(e.target.attributes.getNamedItem('data-item').value)) {
	                        _item = _.attempt(JSON.parse.bind(null, e.target.attributes.getNamedItem('data-item').value));
                        }

                        if(_.includes(['js'], _item.ftype)){
                            return {

                                items: {

                                    "read": {
                                        name: "下载", icon: "fas fa-download", callback: function (key, opt) {
                                            self.downloadIt(_item,true);
                                        }
                                    },
                                    "run": {
                                        name: "编辑/运行", icon: "fas fa-play", callback: function (key, opt) {
                                            self.editIt(_item);
                                        }
                                    },
                                    "sep1": "---------",
	                                "delete": {
                                        name: "删除", icon: "fas fa-trash", callback: function (key, opt) {
                                            self.deleteIt(_item,true);
                                        }
                                    },
                                    "sep3": "---------",
                                    "share": {
                                        name: "共享", icon: "fas fa-share-square", callback: function (key, opt) {
                                            self.shareIt(_item);
                                        }
                                    },
                                    "sep4": "---------",
                                    "info": {
                                        name: "属性", icon: "fas fa-info", callback: function (key, opt) {
                                            self.info(_item);
                                        }
                                    }
                                }

                            }
                        } else if(_.includes(['html','htm'], _item.ftype)){
                            return {

                                items: {
                                    "deploy": {
                                        name: "发布应用", icon: "fab fa-codepen", callback: function (key, opt) {
                                            self.deployIt(_item);
                                        }
                                    },
                                    "read": {
                                        name: "下载", icon: "fas fa-download", callback: function (key, opt) {
                                            self.downloadIt(_item,true);
                                        }
                                    },
                                    "edit": {
                                        name: "编辑", icon: "fas fa-edit", callback: function (key, opt) {
                                            self.editIt(_item);
                                        }
                                    },
                                    "run": {
                                        name: "运行", icon: "fas fa-play", callback: function (key, opt) {
                                            self.runHtml(_item);
                                        }
                                    },
                                    "runUrl": {
                                        name: "运行链接", icon: "fas fa-map-marker-alt", callback: function ($element,key, opt) {
                                            self.copyUrl(_item);
                                        }
                                    },
                                    "sep1": "---------",
                                    "delete": {
                                        name: "删除", icon: "fas fa-trash", callback: function (key, opt) {
                                            self.deleteIt(_item,true);
                                        }
                                    },
                                    "sep3": "---------",
                                    "share": {
                                        name: "共享", icon: "fas fa-share-square", callback: function (key, opt) {
                                            self.shareIt(_item);
                                        }
                                    },
                                    "sep4": "---------",
                                    "info": {
                                        name: "属性", icon: "fas fa-info", callback: function (key, opt) {
                                            self.info(_item);
                                        }
                                    }
                                }

                            }
                        } else if(_.includes(['md','json'], _item.ftype)){
                            return {

                                items: {
                                    "read": {
                                        name: "下载", icon: "fas fa-download", callback: function (key, opt) {
                                            self.downloadIt(_item,true);
                                        }
                                    },
                                    "edit": {
                                        name: "编辑", icon: "fas fa-edit", callback: function (key, opt) {
                                            self.editIt(_item);
                                        }
                                    },
                                    "run": {
                                        name: "打开", icon: "fas fa-play", callback: function (key, opt) {
                                            self.openIt(_item,null);
                                        }
                                    },
                                    "runUrl": {
                                        name: "打开链接", icon: "fas fa-map-marker-alt", callback: function ($element,key, opt) {
                                            self.copyUrl(_item);
                                        }
                                    },
                                    "sep1": "---------",
                                    "delete": {
                                        name: "删除", icon: "fas fa-trash", callback: function (key, opt) {
                                            self.deleteIt(_item,true);
                                        }
                                    },
                                    "sep3": "---------",
                                    "share": {
                                        name: "共享", icon: "fas fa-share-square", callback: function (key, opt) {
                                            self.shareIt(_item);
                                        }
                                    },
                                    "sep4": "---------",
                                    "info": {
                                        name: "属性", icon: "fas fa-info", callback: function (key, opt) {
                                            self.info(_item);
                                        }
                                    }
                                }

                            }
                        } else if(_.includes(['imap','iflow','ishow'], _item.ftype)){
                            return {

                                items: {

                                    "read": {
                                        name: "下载", icon: "fas fa-download", callback: function (key, opt) {
                                            self.downloadIt(_item,true);
                                        }
                                    },
                                    "run": {
                                        name: "编辑", icon: "fas fa-edit", callback: function (key, opt) {
                                            self.editIt(_item);
                                        }
                                    },
                                    "sep1": "---------",
                                    "delete": {
                                        name: "删除", icon: "fas fa-trash", callback: function (key, opt) {
                                            self.deleteIt(_item,true);
                                        }
                                    },
                                    "sep3": "---------",
                                    "share": {
                                        name: "共享", icon: "fas fa-share-square", callback: function (key, opt) {
                                            self.shareIt(_item);
                                        }
                                    },
                                    "sep4": "---------",
                                    "info": {
                                        name: "属性", icon: "fas fa-info", callback: function (key, opt) {
                                            self.info(_item);
                                        }
                                    }
                                }

                            }
                        } else {
                            return {

                                items: {
                                    "open": {
                                        name: "打开", icon: "fas fa-folder-open", callback: function (key, opt) {
                                            self.openIt(_item);
                                        }
                                    },
                                    "sep1": "---------",
                                    "download": {
                                        name: "下载", icon: "fas fa-download", callback: function (key, opt) {
                                            if(_item.ftype==='dir'){
                                                self.exportIt(_item.fullname);
                                            } else {
                                                self.downloadIt(_item,true);
                                            }
                                        }
                                    },
                                    "sep2": "---------",
                                    "copy": {
                                        name: "复制", icon: "fas fa-copy", callback: function (key, opt) {
                                            self.copyIt(_item);
                                        }
                                    },
                                    "paste": {
                                        name: "粘贴", icon: "fas fa-paste", callback: function (key, opt) {
                                            self.pasteIt();

                                        }
                                    },
                                    "sep3": "---------",
                                    "delete": {
                                        name: "删除", icon: "fas fa-trash", callback: function (key, opt) {
                                            self.deleteIt(_item,true);
                                        }
                                    },
                                    "sep4": "---------",
                                    "share": {
                                        name: "共享", icon: "fas fa-share-square", callback: function (key, opt) {
                                            self.shareIt(_item);
                                        }
                                    },
                                    "sep5": "---------",
                                    "info": {
                                        name: "属性", icon: "fas fa-info", callback: function (key, opt) {
                                            self.info(_item);
                                        }
                                    }
                                }

                            }
                        }

                    }
                });
			},
			initEditName: function(){
			    const self = this

                $(".fs-name[data-edit='true']").editable({
                    title: "重命名",
	                type: "text",
	                pk: $(this).data("pk"),
                    container: 'body',
                    validate: function (value) {
                        if (!$.trim(value)) {
                            return '不能为空';
                        }
                    },
                    display: function(value, sourceData) {
                        if(value.length > 10) {
                            $(this).html(_.split(value,"",9).join("")+"...");
                        }
                    },
                    success: function (response,newValue) {

                        let _item = $(this).data("info");

                        let _old = _.trim(_item.parent + "/" + $(this).editable('getValue', true));
                        let _new = _.trim(_item.parent + "/" + newValue);

                        let _check = fsHandler.fsCheck( _item.parent, newValue);
                        if(_check) {
                            alertify.error("文件已存在，请确认！")
                            return false;
                        }

                        let _rtn = fsHandler.fsRename(_old, _new);

                        if(_rtn == 1){
                            self.load();
                        } else {
                            $(this).innerHTML($(this).editable('getValue', true));
                        }
                    }
                });

			},
            initFileUpload: function(){
                const self = this
                let uploadButton = $('<button/>')
                    .addClass('btn btn-xs btn-primary')
                    .prop('disabled', true)
                    .text('准备中...')
                    .on('click', function () {
                        var $this = $(this),
                            data = $this.data();
                        $this
                            .off('click')
                            .text('中止')
                            .on('click', function () {
                                $this.remove();
                                data.abort();
                            });
                        data.submit().always(function () {
                            $this.remove();
                        });
                    });

                $('#file-upload').fileupload(self.upload.option)
                    .on('fileuploadadd', function (e, data) {

                        let title = "上传";

                        let wnd = maxWindow.winUpload(title, '<div id="files" class="files"></div>', null,null);

                        // 更新信息栏信息
                        new Vue({
                            delimiters: ['#{', '}#'],
                            el: `#jsPanel-upload-footer-${objectHash.sha1(title)}`,
	                        template: `<div class="pull-left" style="width: 100%;"><i class="fas fa-clock"></i> #{stime}# | 上传文件：#{total}# </div>`,
	                        data: {
                                stime: moment().format("LLL"),
                                utime: '',
								upload: 0,
		                        total: data.originalFiles.length,
		                        interval: null
                            },
	                        created: function(){
                                //eventHub.$on("UPLOAD-UPDATE-STATUS-EVENT",this.update);

                                /*this.interval = setInterval(function(){
                                    this.utime = moment(this.stime).fromNow();
                                },1000)*/
                            },
	                        methods: {
                                update: function(event){

                                    if(event.stop){
                                        //clearInterval(this.interval);
                                    }

                                    if(event.upload){
                                        this.upload += event.upload;
                                    }

                                }
                            }
                        });

                        data.context = $('<ul/>').appendTo('#files');

                        $.each(data.files, function (index, file) {

                            let _name = file.name;

                            if(!_.isEmpty(file.name) && _.size(file.name) > 9){
                                _name = _.split(file.name,"",9).join("")+"..."
                            }

                            var node = $('<li/>')
                                .append($(`<a href="#" class="thumbnail" style="border:none;-webkit-box-shadow: unset;box-shadow: unset;"/>`)
                                    .text(_name))
                                .attr("title",file.name)
                                .append($(`<div id="progress_${objectHash.sha1(file.name)}" class="progress">
										        <div class="progress-bar progress-bar-success"></div>
	                                       </div>`));
                            if (!index) {
                                node
                                    .append(uploadButton.clone(true).data(data));
                            }
                            node.appendTo(data.context);
                        });
                    })
                    .on('fileuploadprocessalways', function (e, data) {
                        var index = data.index,
                            file = data.files[index],
                            node = $(data.context.children()[index]);

                        if (file.preview) {
                            node
                                .prepend(file.preview);
                        }else{
                            node
                                .prepend(`<span class="fa fa-file fa-4x preview-null"></span>`);
                        }

                        if (file.error) {
                            node
                                .append('<hr>')
                                .append($('<span class="text-danger"/>').text(file.error));
                        }
                        if (index + 1 === data.files.length) {
                            data.context.find('button')
                                .text('上传')
	                            .css('display','none')
                                .prop('disabled', !!data.files.error);
                        }

                        //更新底部状态信息
                        //eventHub.$emit("UPLOAD-UPDATE-STATUS-EVENT",{total: null, etime: null, upload: index + 1})
                    })
                    .on('fileuploadprogress', function (e, data) {

                        let _name = objectHash.sha1(data.files[0].name);
                        let progress = parseInt(data.loaded / data.total * 100, 10);
                        $(`#progress_${_name} .progress-bar`).css(
                            'width',
                            progress + '%'
                        ).html(`<small>${parseInt(data.loaded/1024,10)} KB / ${parseInt(data.total/1024,10)} KB</small>`);
                    })
                    .on('fileuploaddone', function (e, data) {

                        $.each(data.files, function (index, file) {

                            if (file.name) {
                                // var link = $('<a>')
                                //     .attr('target', '_blank')
                                //     .prop('href', file.url);
                                // $(data.context.children()[index])
                                //     .wrap(link);
                                $(`#progress_${objectHash.sha1(file.name)} .progress-bar`).html(`<small>已完成</small>`);
                            } else if (file.error) {
                                var error = $('<span class="text-danger"/>').text(file.error);
                                $(data.context.children()[index])
                                    .append('<br>')
                                    .append(error);
                            }
                        });

                        self.load();

                        //更新底部状态信息
                        //eventHub.$emit("UPLOAD-UPDATE-STATUS-EVENT",{total: null, etime: _.now(), upload: 0, stop: true})

                        // close upload win

                    })
                    .on('fileuploadfail', function (e, data) {
                        $.each(data.files, function (index) {
                            var error = $('<span class="text-danger"/>').text('上传失败。');
                            $(data.context.children()[index])
                                .append('<br>')
                                .append(error);
                        });
                        // close upload win

                    })
                    .prop('disabled', !$.support.fileInput)
                    .parent().addClass($.support.fileInput ? undefined : 'disabled');
            },
            resetStatus: function(){
				const self = this

                self.selectedItem = [];
            },
			orderIt: function(){
			    const self = this

                $.contextMenu({
                    selector: '.fs-order',
                    trigger: 'left',
                    callback: function (key, options) {
						if(key == 'byNameAsc'){
                            self.model = _.orderBy(self.model,['name'],['asc']);
						} else if(key == 'byNameDesc'){
							self.model = _.orderBy(self.model,['name'],['desc']);
						} else if(key == 'byTimeAsc'){
                            self.model = _.orderBy(self.model,['vtime'],['asc']);
                        } else if(key == 'byTimeDesc'){
                            self.model = _.orderBy(self.model,['vtime'],['desc']);
                        } else {
                            self.model = _.orderBy(self.model,['ftype'],['asc']);
						}
                    },
                    items: {
                        "byNameAsc": { name: "按名称升序",icon: "fas fa-sort-alpha-up" },
                        "byNameDesc": { name: "按名称降序",icon: "fas fa-sort-alpha-down" },
                        "byTimeAsc": { name: "按时间升序",icon: "fas fa-sort-alpha-up" },
                        "byTimeDesc": { name: "按时间降序",icon: "fas fa-sort-alpha-down" },
                        "byFtype": { name: "按类型排序",icon: "fas fa-sort-alpha-down" },
                    }
                });

			},
			openIt: function(item, path){
                const self = this

                // 点击【我的文件】返回不同的root
                if(_.isNull(item)){
                    self.rootPath = self.root;
                    return;
                }

                if(typeof(item) === 'string' || item.ftype === 'dir'){
                    self.rootPath = path.replace(/\/\//g,'/');
                    return;
                }

                if(!_.isEmpty(item)){

                    if(_.includes(['png','jpg','jpeg','gif'], item.ftype)) {


                        let contents = `<img src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}" class="preview-img-responsive center-block" alt="Image">`;
                        let _wnd = maxWindow.winApp(item.name, contents, null,null);

                    } else if(_.includes(['mov','mp4','avi'], item.ftype)) {

                        let contents = `<div class="embed-responsive embed-responsive-16by9">
                                            <video src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}" controls="controls" autoplay>
												your browser does not support the video tag
											</video>
										</div>
										`;

                        let _wnd = maxWindow.winApp(item.name, contents, null,null);

                    } else if(_.includes(['pdf'], item.ftype)) {

                        let contents = `<div class="embed-responsive embed-responsive-16by9">
                                            <iframe class="embed-responsive-item" src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}"></iframe>
										</div>`;

                        let _wnd = newWindow('fsapp', item.name, contents, null,null);

                    } else if(_.includes(['pptx','ppt'], item.ftype)) {

                        window.open(`/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}`, "_blank");

                    } else if(_.includes(['js','ltsv','txt','csv','html','json'], item.ftype)) {

                       self.editIt(item);

                    } else if(_.includes(['swf'], item.ftype)) {
                        let contents = `<div class="embed-responsive embed-responsive-16by9">
											<video src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}" width="100%" height="100%" controls="controls" autoplay>
												Your browser does not support the video tag.
											</video>
										</div>`;

                        let _wnd = maxWindow.winApp(item.name, contents, null,null);
                    } else if(_.includes(['imap','iflow', 'ishow'], item.ftype)) {

                        _.merge(item,{action:'run'});

                        let url = fsHandler.genFsUrl(item,null,null);

                        window.open(url,'_blank');
                    } else if(_.includes(['md'], item.ftype)){
                        _.merge(item,{action:'run'});

                        let url = fsHandler.genFsUrl(item,{ header:true, sidebar:true, footbar:true },null);

                        window.open(url,'_blank');
                    }
                }

            },
			runHtml: function(item){
			    const self = this

                let file = [item.parent, item.name].join("/");
                window.open(`/fs${file}?issys=true&type=open&issys=${window.SignedUser_IsAdmin}`,'_blank');
			},
			copyUrl: function(item){
			    const self = this

                let file = `/fs${[item.parent, item.name].join("/")}?type=open&issys=${window.SignedUser_IsAdmin}`;

                if(_.includes(['md','imap','iflow','ishow'],item.ftype)){
                    _.merge(item,{action:'run'});
                    file = fsHandler.genFsUrl(item,{ header:true, sidebar:false, footbar:true },null);
                }

                alertify.set({ labels: {
                        ok     : "复制地址",
                        cancel : "取消"
                }});

                alertify.prompt("运行链接地址", function (e, str) {
                    // str is the input text
                    if (e) {
                        // user clicked "ok"
	                    let clipboard = new Clipboard('.alertify-button-ok', {
                            text: function (trigger) {
                                return str;
                            }
                        });
                    } else {
                        // user clicked "cancel"
                    }
                }, file);

                $(".alertify-prompt .alertify-message").css('height','5vh');

			},
            load: function() {
                const self = this

                // 临时解决view刷新问题 & destroy editable
	            self.currentView = '';

	            _.delay(function(){

	                // 临时解决view刷新问题
	                self.currentView = self.defaultView;

                    // 重置选择
                    self.selectedItem = [];

                    let _rtn = fsHandler.fsList(self.rootPath);

                    self.model = _.orderBy(_.map(_rtn,function(v,k){

                        return _.merge(v, {"username": `${self.signedUserName}`});

                    }),['vtime','name'],['desc','asc']);

                    _.delay(function(){
                        // 刷新
                        self.refresh();
                    },100);
	            },100)

            },
            refresh: function() {
                const self = this

                // 重新实例化 editable
                self.initEditName();
            },
			mouseOver: function(item){
                const self = this

                $(self.$el).find('.fs-node-highlight').removeClass('fs-node-highlight');
                $('#fs_node_'+item.id).find('.widget').addClass('fs-node-highlight');

            },
            mouseOut: function(item){
                const self = this

                $('#fs_node_'+item.id).find('.fs-node-highlight').removeClass('fs-node-highlight');
            },
            newDir: function() {
                const self = this

                let _name = '新文件夹_' + _.now();
                let _type = 'dir';
                let _attr = {remark: '', ctime: _.now(), author: self.signedUserName};

                let _rtn = fsHandler.fsNew(_type, self.rootPath, _name, null, _attr);

                if(_rtn == 1){
                    self.load();
                }
            },
            newFile: function() {
                fileSystem.fileNew(this.rootPath,this.load);
            },
            info: function(node){
                const self = this

                let _win = maxWindow.winInfo("属性",'<div id="fs-info"></div>',null,$('#content'));

                let _attr = {"attr": `{"remark": "", "ctime": ${_.now()}, "author": ${window.SignedUser_UserName}, "type": "${node.ftype}", "icon": "${window.ASSETS_ICON}/files/png/${node.ftype}.png?type=download&issys=${window.SignedUser_IsAdmin}"}`};

                if(_.isEmpty(node.attr)){
                    node = _.merge(node, _attr);
                }

                let _infoVue = new Vue({
                    delimiters: ['#{', '}#'],
                    el: "#fs-info",
                    template: `<div class="tab-content" style="height:100%;">
                                            <div role="tabpanel" class="tab-pane active" id="home"  style="height:100%;">
                                                <form  style="height:95%;overflow:auto;">
                                                    <div class="form-group">
                                                        <label for="name">名称</label>
                                                        <input type="text" class="form-control" id="name" placeholder="" v-model="model.newName" autofocus @keyup.enter="save">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="remark">备注</label>
                                                        <textarea type="text" class="form-control" rows="2" id="remark" placeholder="" v-model="model.attr.remark"></textarea>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="ctime">更新时间</label>
                                                        <input type="text" class="form-control" id="ctime" placeholder="" :value="model.attr.ctime | toLocalTime" disabled>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="parent">目录</label>
                                                        <input type="text" class="form-control" id="parent" placeholder="" v-model="model.parent" disabled>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="type">类型</label>
                                                        <input type="text" class="form-control" id="type" placeholder="" v-model="model.type" disabled>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="type">大小</label>
                                                        <input type="text" class="form-control" id="size" placeholder="" value="${mx.bytesToSize(node.size)}" disabled>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="author">作者</label>
                                                        <input type="text" class="form-control" id="author" placeholder="" v-model="model.attr.author" disabled>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="icon">图标</label>
                                                        <a href="#icon-list" aria-controls="icon-list" role="tab" data-toggle="tab">
                                                            <img class="media-object" :src="model.icon.value" style="width:15%;">
                                                        </a>
                                                    </div>

                                               </form>
                                                <div class="form-group" style="text-align: center;padding-top:3px;">
                                                    <a href="javascript:void(0)" class="btn btn-sm btn-warning" @click="apply">应用</a>
                                                    <a href="javascript:void(0)" class="btn btn-sm btn-success" @click="save">确定</a>
                                                    <a href="javascript:void(0)" class="btn btn-sm btn-default" @click="close">取消</a>
                                                </div>
                                            </div>
                                            <div role="tabpanel" class="tab-pane" id="icon-list" style="height:100%;">
                                                <div class="row" style="height:95%;">
                                                  <div class="col-md-12" style="display: list-item;height: 95%;overflow: auto;">
                                                    <ul>
                                                        <li v-for="icon in model.icon.list">
                                                            <a href="#" class="thumbnail" style="border:none;" @click="triggerInput(icon.id)">
                                                              <img class="media-object" :src="icon | pickIcon" style="max-width: 55px;min-width: 55px;;">
                                                              <input type="radio" :ref="icon.id" :id="icon.id"  :value="'/fs'+icon.parent+'/'+icon.name+'?type=download&issys=${window.SignedUser_IsAdmin}'" v-model="model.icon.value" >
                                                            </a>
                                                        </li>
                                                    </ul>
                                                  </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12" style="text-align:center;">
                                                        <a class="btn btn-sm btn-default" href="#home" aria-controls="home" role="tab" data-toggle="tab">返回</a></li>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>`,
                    data: {
                        model: {
                            parent: node.parent,
                            oldName: node.name,
                            newName: node.name,
                            type: node.ftype,
                            attr: {remark:''},
                            icon: {
                                value: null,
                                list: []
                            }
                        }
                    },
                    mounted: function() {
                        let me = this;

                        me.$nextTick(function() {
                            me.model.attr = _.attempt(JSON.parse.bind(null, node.attr));
                            me.model.icon.value = me.model.attr.icon;
                            me.init();
                        })
                    },
                    filters: {
                        pickName: function (value) {
                            let me = this;

                            if (!value) return '';

                            let _attr = _.attempt(JSON.parse.bind(null, value));

                            return _attr.name;
                        },
                        pickIcon: function(item) {
                            return `/fs${item.parent}/${item.name}?type=download&issys=${window.SignedUser_IsAdmin}`;
                        },
                        readMore: function (text, length, suffix) {
                            return text.substring(0, length) + suffix;
                        },
                        toLocalTime: function (value) {
                            return moment(value).format("LLL");
                        }
                    },
                    destroyed: function(){
                        let me = this;

                        me.model = null;
                    },
                    methods: {
                        init: function(){
                            let me = this;

                            me.model.icon.list = fsHandler.fsList('/assets/images/files/png');
                        },
                        triggerInput: function(id){
                            const self = this

                            $(self.$refs[id]).click()
                        },
	                    apply: function(){
	                        let me = this;

	                        me.saveAttr();

	                    },
	                    save: function(){
	                        let me = this;

	                        me.saveAttr();
	                        _win.close();
	                    },
	                    close: function(){
	                        let me = this;

	                        _win.close();
	                    },
                        saveName: function(){
                            let me = this;

                            let _extName = node.ftype=='dir'?'':'.'+node.ftype;
                            let _old = node.parent + "/" + node.name;// + _extName;
                            let _new = node.parent + "/" + me.model.newName;// + _extName;


                            let _check = fsHandler.fsCheck( node.parent, me.model.newName);
                            if(_check) {
                                alertify.error("文件已存在，请确认！")
                                return false;
                            }

                            let _rtn = fsHandler.fsRename(_old, _new);

                            if(_rtn == 1){
                                self.load();
                            }
                        },
                        saveAttr: function(){
                            let me = this;

                            me.model.attr = me.model.icon.value?_.extend(me.model.attr, {icon: me.model.icon.value}):me.model.attr;

                            let _rtn = fsHandler.fsUpdateAttr(node.parent, node.name, me.model.attr);

                            if(_rtn == 1){
                                self.load();
                                $(".list-context-menu").contextMenu('update');

                                if(me.model.oldName != me.model.newName){
                                    me.saveName();
                                }
                            }
                        }
                    }
                })

            },
			copyIt: function(item){
                const self = this;

                self.selectedItem = [];
                window.fsSelectedItem = [];
                self.selectedItem[0] = item;
                window.fsSelectedItem = _.cloneDeep(self.selectedItem)
                alertify.log(`已复制 ${window.fsSelectedItem.length} 项`);
            },
            copyThem(){
                const self = this;

                window.fsSelectedItem = _.cloneDeep(self.selectedItem);
                alertify.log(`已复制 ${window.fsSelectedItem.length} 项`);
            },
            moveIt: function(){
                const self = this;
                
                
                if(_.isEmpty(window.fsSelectedItem)) {
                    alertify.log("请选择移动内容")
                    return false;
                }
                
                alertify.confirm(`确认要将下列所选文件移动到 ${self.rootPath} 目录? <br><br> ${_.map(window.fsSelectedItem,'name').join("<br>")}`, function (e) {
                    if (e) {
                        try {
                            let rtn = true;
                            _.forEach(window.fsSelectedItem,function(v){
                                let _rtn = fsHandler.fsMove([v.parent,v.name].join("/"), self.rootPath);
                                if(_rtn===0){
                                    rtn = false;
                                }
                            })
                            if(rtn){
                                alertify.success("移动成功 " + self.rootPath);
                                self.load();
                            }
                        }
                        catch(error){}
                        finally{
                            window.fsSelectedItem = [];
                        }
                    } else {
                        
                    }
                });
            },
            pasteIt: function(){
                const self = this

                if(_.isEmpty(window.fsSelectedItem)) {
                    alertify.log("请选择复制内容")
                    return false;
                }
                
                alertify.confirm(`确认要将下列所选文件复制到 ${self.rootPath} 目录? <br><br> ${_.map(window.fsSelectedItem,'name').join("<br>")}`, function (e) {
                    if (e) {
                        try {
                            let rtn = true;
                            _.forEach(window.fsSelectedItem,function(v){
                                let _rtn = fsHandler.fsCopy([v.parent,v.name].join("/"), self.rootPath);
                                if(_rtn===0){
                                    rtn = false;
                                }
                            })
                            if(rtn){
                                alertify.success("复制成功 " + self.rootPath);
                                self.load();
                            }
                        }
                        catch(error){}
                        finally{
                            window.fsSelectedItem = [];
                        }
                    } else {
                        
                    }
                });
            },
            deleteThem: function() {
                const self = this

                if(_.includes([['app','extend','assets','opt','script']],self.selectedItem[0].name)){
                    alertify.error("系统目录，不允许删除!");
                    return false;
                }

                if(_.isEmpty(self.selectedItem)) {
                    alertify.log("选择需要删除的对象！");
                    return false;
                }

        
                alertify.confirm(`确定要删除 ${self.rootPath} 目录下的选定文件：<br><br> ${_.map(self.selectedItem,'name').join("<br>")}`, function (e) {
                    if (e) {
                        _.forEach(self.selectedItem, function(v){
                            self.deleteIt(v, false);
                        })
                    } else {
                        
                    }
                });

            },
			deleteIt: function(event, prompt) {
                const self = this

                if(_.includes(['admin','app','extend','assets','opt','script'],event.name)){
                    alertify.error("系统目录，不允许删除!");
                    return false;
                }

                if(_.isEmpty(event)) {
                    alertify.log("选择需要删除的对象！");
                    return false;
                }

                if(prompt){
                    
                    alertify.confirm(`确定要删除 ${event.name} 文件?`, function (e) {
                        if (e) {
                            let _rtn = fsHandler.fsDelete(event.parent,event.name);

                            if (_rtn == 1){
                                self.load();
                            }
                        } else {
                            
                        }
                    });
                    
                } else {

                    let _rtn = fsHandler.fsDelete(event.parent,event.name);

                    if (_rtn == 1){
                        self.load();
                    }
                }

            },
			shareIt: function(event){
				const self = this

                alertify.prompt("共享设置", function (e, str) {
                    // str is the input text
                    if (e) {
                        // user clicked "ok"
                    } else {
                        // user clicked "cancel"
                    }
                }, "admin;");
                $(".alertify-prompt .alertify-message").css('height','5vh');
			},
            deployIt: function(item){
                const self = this

                let wnd = maxWindow.winDeployApp( `<i class="fab fa-codepen"></i> 应用发布`, `<div id="fs-app-deploy"></div>`, null, 'content');

                let form = {
                    el: "#fs-app-deploy",
                    template:`<div class="tab-content">
		                        <div role="tabpanel" class="tab-pane active" id="fs-deploy-home" style="padding:15px;">
		                            <form class="form-horizontal">
		                              <div class="form-group">
		                                <label class="col-sm-2 control-label">应用名称</label>
		                                <div class="col-sm-10">
		                                  <input type="text" class="form-control" placeholder="" v-model="app.cnname" required autofocus>
		                                </div>
		                              </div>
		                              <div class="form-group">
		                                <label class="col-sm-2 control-label">英文名称</label>
		                                <div class="col-sm-10">
		                                  <input type="text" class="form-control" placeholder="" v-model="app.enname" required>
		                                </div>
		                              </div>
		                              <div class="form-group">
		                                <label class="col-sm-2 control-label">图标</label>
		                                <div class="col-sm-10">
		                                    <a href="#fs-deploy-icon-list" aria-controls="fs-deploy-icon-list" role="tab" data-toggle="tab">
		                                        <img class="media-object" :src="app.icon.value" style="width:48px;height:48px;filter:grayscale(100%) brightness(45%) sepia(100%) hue-rotate(-180deg) saturate(700%) contrast(0.8);" >
		                                    </a>
		                                </div>
		                              </div>
		                              <div class="form-group">
		                                <div class="col-sm-offset-2 col-sm-10">
		                                  <a class="btn btn-sm btn-primary" @click="deploy">发布</a>
		                                  <a class="btn btn-sm btn-default" @click="cancel">取消</a>
		                                </div>
		                              </div>
		                            </form>
		                        </div>
		                        <div role="tabpanel" class="tab-pane" id="fs-deploy-icon-list" style="padding:10px;">
		                            <div class="row">
		                              <div class="col-md-12" style="display: list-item;height: 35vh;overflow: auto;">
		                                <ul>
		                                    <li v-for="icon in app.icon.list" style="width: 68px;height: 68px;padding: 0px;">
		                                        <a href="#" class="thumbnail" style="border:none;height:100%;" @click="triggerInput(icon.id)">
		                                          <img class="media-object" :src="icon | pickIcon" style="max-width: 34px;min-width: 34px;filter:grayscale(100%) brightness(45%) sepia(100%) hue-rotate(-180deg) saturate(700%) contrast(0.8);">
		                                          <input type="radio" :ref="icon.id" :id="icon.id"  :value="'/fs'+icon.parent+'/'+icon.name+'?type=download&issys=${window.SignedUser_IsAdmin}'" v-model="app.icon.value" >
		                                        </a>
		                                    </li>
		                                </ul>
		                              </div>
		                            </div>
		                            <div class="row" style="margin-top:15px;">
		                                <div class="col-md-12" style="text-align:center;">
		                                    <a class="btn btn-sm btn-default" href="#fs-deploy-home" aria-controls="fs-deploy-home" role="tab" data-toggle="tab">返回</a></li>
		                                </div>
		                            </div>
		                        </div>

		                    </div>`,
                    data: {
                        app: {
                            cnname: _.head(item.name.split(".")),
                            enname: _.head(item.name.split(".")),
                            seat: _.random(100, 10000),
                            url: `/fs${[item.parent, item.name].join("/")}?issys=true&type=open&issys=${window.SignedUser_IsAdmin}`,
                            icon: {
                                value: '',
                                list: []
                            }
                        }
                    },
                    filters:{
                        pickIcon: function(icon) {
                            return `/fs${icon.parent}/${icon.name}?type=download&issys=${window.SignedUser_IsAdmin}`;
                        }
	                },
                    mounted: function() {
                        let me = this;

                        me.$nextTick(function() {
                            me.app.icon.value = `${window.ASSETS_ICON}/apps/png/creative.png?type=download&issys=${window.SignedUser_IsAdmin}`;

                            me.init();
                        })
                    },
                    methods: {
                        init: function(){
                            let me = this;

                            me.app.icon.list = fsHandler.fsList(`${window.ASSETS_ICON}/apps/png`);

                        },
                        triggerInput: function(id){
                            let me = this;

                            $(me.$refs[id]).click()
                        },
                        deploy: function(){
                            let me = this;

                            let check = fsHandler.callFsJScript("/apps/app_exist_check.js",encodeURIComponent(JSON.stringify(me.app.cnname))).message;;

                            if(check==1){
                                alertify.log("应用已经发布，请确认。")
	                            return false;
                            }

                            let app = {
                                cnname: me.app.cnname,
                                enname: me.app.enname,
                                icon: me.app.icon.value.replace(/\/fs\/assets\/images\/apps\/png\//,'').replace(/\?type=download&issys=true/,''),
	                            seat: me.app.seat,
                                url: me.app.url
                            };

                            let rtn = fsHandler.callFsJScript("/apps/app.js",encodeURIComponent(JSON.stringify(app)));
                            if( _.lowerCase(rtn.status) == "ok"){
                                alertify.success("应用发布成功");
                                eventHub.$emit("APP-REFRESH-EVENT");

                                $("ul.nav").find("li>a[title='应用']").popover({
                                    container: "body",
                                    title: "",
                                    content: `${me.app.cnname} 应用发布成功！`
                                }).popover('show');

                                _.delay(function(){
                                    $("ul.nav").find("li>a[data-original-title='应用']").popover('destroy');
                                },8000)


                                wnd.close();
                            }
                        },
                        cancel:function(){
                            wnd.close();
                        }
                    }
                };
                new Vue(form);

            },
			editIt: function(item){
                const self = this

                // 不同窗体对应各自的ID，由窗体ID生成各窗体组件的子ID
                // 子ID：
                //      fs-editor-main-top-${ID}
                //      fs-editor-main-bottom-${ID}
                let pID = objectHash.sha1([item.parent,item.name].join("/"));

                // 模板，作为vue组件容器
                let content = `<div id="fs-editor-template-${pID}" style="width: 100%;height: 100%;"></div>`;

				// 判断是否已有窗体打开
                try {
                    if( window.jsPanel.activePanels.getPanel(`jsPanel-editor-${pID}`) ){
                        window.jsPanel.activePanels.getPanel(`jsPanel-editor-${pID}`).front();
                        alertify.log("该内容窗体已经打开");
                    }
                }
                catch(err){
                    // 打开窗体
                    let win = maxWindow.winEditor(`${item.parent}/${item.name}`, content, null,null);

                    // 应用扩展名影射不同的编辑模式
                    let mode = function(){
                        let list = {js:'javascript', ltsv: 'toml', file: 'text', html: 'html', md: 'markdown', json: 'json', csv: 'csv'};
                        return list[item.ftype] || 'javascript';
                    };

                    // 生成布局、vue组件配置，根据不同的文件类型，需要对应不同的编辑器
                    let editor = {
                        normal: {
                            el: `#fs-editor-template-${pID}`,
                            data: {
                                layout: null,
                                config: {
                                    settings: {
                                        hasHeaders: true,
                                        showPopoutIcon: false,
                                        showCloseIcon: false,
                                        selectionEnabled: false,
                                        constrainDragToContainer: false
                                    },
                                    dimensions: {
                                        borderWidth: 3
                                    },
                                    content: [{
                                        type: 'column',
                                        content: [{
                                            type: 'component',
                                            title: '编辑',
                                            height: 85,
                                            componentName: 'fsEditorComponent',
                                            componentState: {
                                                id: 'editor-main-top',
                                                div: `<div id="fs-editor-main-top-${pID}"></div>`
                                            }
                                        }, {
                                            type: 'component',
                                            title: '结果',
                                            height: 15,
                                            componentName: 'fsEditorComponent',
                                            componentState: {
                                                id: 'editor-main-bottom',
                                                div: `<div id="fs-editor-main-bottom-${pID}"></div>`
                                            }
                                        }]
                                    }]
                                },
                                editor: {
                                    el: `#fs-editor-main-top-${pID}`,
                                    template: `<fs-editor-component :id="id" :bid="bid"
								                      :model="model"
								                      showToolsBar="false"
								                      showStatusBar="false"></fs-editor-component>`,
                                    data: {
                                        id: `editor-${pID}`,
                                        bid: `${pID}`,
                                        model: {
                                            oldInput: "",
                                            newInput: "",
                                            mode: mode(),
                                            theme: "terminal",
                                            printMargin: false,
                                            readOnly: false,
                                            fs: item
                                        }
                                    },
                                    mounted: function () {
                                        let me = this;

                                        me.$nextTick(function () {
                                            me.init();
                                        })
                                    },
                                    methods: {
                                        init: function () {
                                            let me = this;

                                            let rtn = fsHandler.fsContent(item.parent, item.name);

                                            me.model.newInput = rtn;

                                            $("li[title='编辑']").parent().parent().css("display", "none");
                                        }
                                    }

                                },
                                output: {
                                    html: {
                                        el: `#fs-editor-main-bottom-${pID}`,
                                        template: `<div class="embed-responsive embed-responsive-16by9" style="overflow-y:auto;">
												  <iframe class="embed-responsive-item" :id="id+'_iframe'" :src="src"></iframe>
												</div>`,
                                        data: {
                                            id: `editor-output-${pID}`,
                                            src: ""
                                        },
                                        watch: {
                                            src: function (val, oldVal) {
                                                let me = this;

                                                document.getElementsByTagName('iframe')[0].src = val;
                                            }
                                        },
                                        created: function () {
                                            let me = this;

                                            eventHub.$on(`FS-EDITOR-RUN-EVENT-${pID}`, me.setSrc)
                                        },
                                        methods: {
                                            setSrc: function (event) {
                                                let me = this;

                                                me.src = event;
                                            }
                                        }
                                    },
                                    other: {
                                        el: `#fs-editor-main-bottom-${pID}`,
                                        template: `<fs-output-component :id="id" :bid="bid"
								                      :model="model"
								                      showToolsBar="false"
								                      showStatusBar="false"></fs-output-component>`,
                                        data: {
                                            id: `editor-output-${pID}`,
                                            bid: `${pID}`,
                                            model: {
                                                oldInput: "",
                                                newInput: "",
                                                mode: "json",
                                                theme: "tomorrow",
                                                printMargin: false,
                                                readOnly: false,
                                            },
                                            keys: []
                                        },
                                        created: function () {
                                            let me = this;

                                            eventHub.$on(`FS-EDITOR-RUN-EVENT-${me.bid}`, me.setData)
                                        },
                                        mounted: function () {
                                            let me = this;

                                            me.$nextTick(function () {
                                                // self.init();
                                            })
                                        },
                                        methods: {
                                            init: function () {
                                                let me = this;

                                                let rtn = fsHandler.callFsJScript(item.name, '');

                                                me.model.newInput = JSON.stringify(rtn.message, null, 4);
                                            },
                                            setData: function (event) {
                                                let me = this;

												if(event.message) {

                                                    if (typeof event.message === 'object') {
                                                        me.model.newInput = JSON.stringify(event.message, null, 2);
                                                    } else {
                                                        me.model.newInput = JSON.stringify(event.message, null, 4);
                                                    }

                                                } else {
                                                    me.model.newInput = event;
												}
                                            }
                                        }

                                    }
                                }
                            },
                            created: function () {
                                let me = this;

                                eventHub.$on("WINDOW-STATUS-CHANGE-EVENT", me.resizeLayout);
                            },
                            mounted: function () {
                                let me = this;

                                me.$nextTick(function () {
                                    setTimeout(function () {
                                        me.init();
                                    });
                                })
                            },
                            methods: {
                                init: function () {
                                    let me = this;

                                    me.layout = new GoldenLayout(me.config, me.$el);

                                    me.layout.registerComponent('fsEditorComponent', function (container, state) {
                                        // console.log(state)
                                    });

                                    me.layout.on('componentCreated', function (component) {

                                        let state = component.config;
                                        let id = state.componentState.id;
                                        let html = state.componentState.div;

                                        component.container.getElement().html(html);
                                    });

                                    //  Initialize GL
                                    me.layout.init();

                                    //  Update GL on window resize
                                    window.addEventListener('resize', function () {
                                        me.layout.updateSize();
                                    });

                                    _.delay(function () {
                                        me.fsEditor();
                                        me.fsOutput();
                                    }, 300);

                                },
                                fsEditor: function () {
                                    let me = this;

                                    new Vue(me.editor);
                                },
                                fsOutput: function () {
                                    let me = this;

                                    if (me.output[item.ftype]) {
                                        new Vue(me.output[item.ftype]);
                                    } else {
                                        new Vue(me.output["other"]);
                                    }
                                },
                                resizeLayout: function () {
                                    let me = this;

                                    me.layout.updateSize();
                                }
                            }
                        },
                        md: {
                            el: `#fs-editor-template-${pID}`,
                            data: {
                                layout: null,
                                config: {
                                    settings: {
                                        hasHeaders: true,
                                        showPopoutIcon: false,
                                        showCloseIcon: false,
                                        selectionEnabled: false,
                                        constrainDragToContainer: false
                                    },
                                    dimensions: {
                                        borderWidth: 3
                                    },
                                    content: [{
                                        type: 'row',
                                        content: [{
                                            type: 'component',
                                            title: '编辑',
                                            height: 50,
                                            componentName: 'fsEditorComponent',
                                            componentState: {
                                                id: 'editor-main-top',
                                                div: `<div id="fs-editor-main-top-${pID}"></div>`
                                            }
                                        }, {
                                            type: 'component',
                                            title: '预览',
                                            height: 50,
                                            componentName: 'fsEditorComponent',
                                            componentState: {
                                                id: 'editor-main-bottom',
                                                div: `<div id="fs-editor-main-bottom-${pID}"></div>`
                                            }
                                        }]
                                    }]
                                },
                                editor: {
                                    delimiters: ['#{', '}#'],
                                    el: `#fs-editor-main-top-${pID}`,
                                    template: `<fs-md-editor-component :id="id" :bid="bid"
								                      :model="model"
								                      showToolsBar="false"
								                      showStatusBar="false"
								                      ref="editor"></fs-md-editor-component>`,
                                    data: {
                                        id: `editor-${pID}`,
                                        bid: `${pID}`,
                                        model: {
                                            oldInput: "",
                                            newInput: "",
                                            mode: mode(),
                                            theme: "tomorrow",
                                            printMargin: false,
                                            readOnly: false,
                                            fs: item
                                        }
                                    },
                                    mounted: function () {
                                        let me = this;

                                        me.$nextTick(function () {
                                            me.init();
                                        })
                                    },
                                    methods: {
                                        init: function () {
                                            let me = this;

                                            let rtn = fsHandler.fsContent(item.parent, item.name);

	                                        me.model.newInput = rtn;

                                        }
                                    }

                                },
                                output: {
                                    el: `#fs-editor-main-bottom-${pID}`,
                                    template:
	                                    `<div :id="id" v-html="compiledMarkdown" style="display: inline-block; overflow:auto; width: 100%;height: 100%;vertical-align: top;box-sizing: border-box;padding: 0 20px;"></div>`,
                                    data: {
                                        id: `editor-output-${pID}`,
                                        compiledMarkdown: ""
                                    },
                                    created: function () {
                                        eventHub.$on(`OUTPUT-CHANGE-EVENT-${pID}`, this.setContent)
                                    },
                                    methods: {
                                        setContent: function (event) {
                                           this.compiledMarkdown = marked(event, { sanitize: true });
                                        }
                                    }
                                }
                            },
                            created: function () {
                                let me = this;

                                eventHub.$on("WINDOW-STATUS-CHANGE-EVENT", me.resizeLayout);
                            },
                            mounted: function () {
                                let me = this;

                                me.$nextTick(function () {
                                    setTimeout(function () {
                                        me.init();
                                    });
                                })
                            },
                            methods: {
                                init: function () {
                                    let me = this;

                                    me.layout = new GoldenLayout(me.config, me.$el);

                                    me.layout.registerComponent('fsEditorComponent', function (container, state) {
                                        // console.log(state)
                                    });

                                    me.layout.on('componentCreated', function (component) {

                                        let state = component.config;
                                        let id = state.componentState.id;
                                        let html = state.componentState.div;

                                        component.container.getElement().html(html);
                                    });

                                    //  Initialize GL
                                    me.layout.init();

                                    //  Update GL on window resize
                                    window.addEventListener('resize', function () {
                                        me.layout.updateSize();
                                    });

                                    _.delay(function () {
                                        me.fsEditor();
                                        me.fsOutput();
                                    }, 300);

                                },
                                fsEditor: function () {
                                    let me = this;

                                    new Vue(me.editor);
                                },
                                fsOutput: function () {
                                    let me = this;

                                    new Vue(me.output);
                                },
                                resizeLayout: function () {
                                    let me = this;

                                    me.layout.updateSize();
                                }
                            }
                        }
                    };

                    // vue组件实例化
	                let ed = item.ftype==='md' ? editor[item.ftype] : editor['normal'];

                    new Vue(ed);
                }
                finally {

                }

            },
            downloadIt: function(item, prompt) {
                const self = this

                if(item.ftype == 'dir'){
                    let rtn = fsHandler.fsList(item.parent);


                } else {

                    /*if(_.includes(['zip','gz','tar','exe','png','gif','svg','doc','ppt','file'],item.ftype)){
                        let _url = `/fs/${item.parent}/${item.name}?type=download`.replace(/\/\//g,'/');
                        let _target = '_blank';
                        // system || extend || ...
                        if(_.startsWith(item.parent,'/extend') || _.startsWith(item.parent,'/script') || _.startsWith(item.parent,'/app')){
                            _url += '&issys=true';
                        }
                        window.open(_url, _target);
                    } else if(_.includes(['mp3','mp4'],item.ftype)){
                        let _url = `/fs/${item.parent}/${item.name}?type=download`.replace(/\/\//g,'/');
                        let _target = '_blank';
                        // system || extend || ...
                        if(_.startsWith(item.parent,'/extend') || _.startsWith(item.parent,'/script') || _.startsWith(item.parent,'/app')){
                            _url += '&issys=true';
                        }
                        window.location.href=_url;
                    } else {
                        let rtn = fsHandler.fsContent(item.parent, item.name);
                        let blob = new Blob([rtn], {type: "text/plain;charset=utf-8"});

                        saveAs(blob, `${item.name}`);
                    }*/

                    let _url = `/fs/${item.parent}/${item.name}?type=download&issys=${window.SignedUser_IsAdmin}`.replace(/\/\//g,'/');
                    let _target = '_blank';
                    // system || extend || ...
                    //if(_.startsWith(item.parent,'/extend') || _.startsWith(item.parent,'/script') || _.startsWith(item.parent,'/app')){
	                /*if(item.parent === "/"){
                        _url += '&issys=true';
                    }*/
                    window.open(_url, _target);
                }


            },
            downloadThem(){
			    const self = this

                let _them = $(".fs-node-highlight .list-context-menu");

                if(_.isEmpty(_them)) {
                    alertify.log("选择需要下载的对象！");
                    return false;
                }

                let zip = new JSZip();
                _.forEach(_them, function(v,k){
                    let item = $(v).data("item");
                    let rtn = fsHandler.fsContent(item.parent, item.name);
                    let blob = new Blob([rtn], {type: "text/plain;charset=utf-8"});
                    zip.file(`${item.name}`,rtn);
                })

                zip.generateAsync({type:"blob"})
                    .then(function(content) {
                        saveAs(content, `${self.rootPath}.zip`);
                    });


            },
			exportIt(path){
                const self = this;
                
                alertify.confirm(`确认要导出 ${path} 目录下的所有文件?`, function (e) {
                    if (e) {
                        fsHandler.fsZip(path);
                    } else {
                        
                    }
                });

			},
            importIt(event) {
                const self = this;

                let file = event.target.files[0];
                
                alertify.confirm(`确认要导入 ${file.name} 文件，导入后将覆盖原有文件，请确认！<br><br>
                                    文件名称：${file.name}<br><br>
                                    修改时间：${file.lastModifiedDate}<br><br>
                                    文件大小：${mx.bytesToSize(file.size)}`, function (e) {
                    if (e) {
                        let rtn = fsHandler.fsUnZip(self.rootPath, file);

                        if(rtn == 1){
                            self.load();
                        }
                    } else {
                        
                    }

                    event.target.value = null;

                });
            },
            syncIt(){
			    const self = this

			    alertify.prompt("同步设置", function (e, str) {
                    // str is the input text
                    if (e) {
                        // user clicked "ok"
                    } else {
                        // user clicked "cancel"
                    }
                }, "url:http://47.92.151.165/matrix/web.git;username:admin;password:admin;interval=24hour;");
                $(".alertify-prompt .alertify-message").css('height','5vh');
            },
            selectIt: function(item){
                const self = this
                
                if(_.find(self.selectedItem,item)) {
                    self.selectedItem = _.filter( self.selectedItem,function(v){ return v.id != item.id} );
                } else {
                    self.selectedItem.push(item);
                }

                window.fsSelectedItem = [];
                
            },
            selectAll: function(){
                const self = this

                let items = $("li.fs-node").find('.fs-name');

                self.selectedItem = [];
        
                _.forEach(items,function(v){
                    let item = $(v).data("info");

                    self.selectedItem.push(item);
                })

                window.fsSelectedItem = [];

            },
			setRootPath: function(item) {
                const self = this;
                
                let _item = _.attempt(JSON.parse.bind(null, decodeURIComponent(window.atob(item))));

                self.openIt(_item, [_item.parent,_item.name].join("/"));

			},
            toggleLeft: function() {
                const self = this;

                if(self.toggle.left) {

                    $("#nav").hide();

                    $("#content").removeClass("col-lg-10");
                    $("#content").addClass("col-lg-12");

                    $(".navtoggle").removeClass("fa fa-caret-left");
                    $(".navtoggle").addClass("fa fa-caret-right");

                    self.toggle.left = false;
                } else {
                    $("#nav").slideDown(500);
                    $("#nav").show();

                    $("#content").removeClass("col-lg-12");
                    $("#content").addClass("col-lg-10");
                    //$("#content").find(".panel-default").css("border-left","2px #ddd dotted");

                    $(".navtoggle").removeClass("fa fa-caret-right");
                    $(".navtoggle").addClass("fa fa-caret-left");

                    self.toggle.left = true;
                }
            }
		}
	
	}
	</script>



</code>
