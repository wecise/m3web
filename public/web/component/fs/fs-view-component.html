<code>

        <style scoped>
            /*----------  style  ----------*/
            .fs-view-component .fs-node-highlight {
                -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
            }
    
            .fs-view-component .fs-node-selected {
                -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
                box-shadow: 0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04);
            }
            
            .fs-view-component .fs-node-selected::before {
                content: '\2713 ';
                font-size: 16px;
                font-weight: 600;
                color: rgba(37, 45, 73, 0.5);
                position: absolute;
                bottom: 5px;
                right: 5px;
            }
    
            .fs-view-component .fs-footer{
                position:fixed;
                bottom:30px;
            }
    
            .editable-click, a.editable-click, a.editable-click:hover {
                border-bottom: none;
            }
    
            .fs-view-component .fa-bars {
                color: rgb(144, 144, 144);
            }

            #fs-editor-main > .el-tabs > .el-tabs__header{
                clear:both;
                min-height: 30px;
            }
    
            /* For note-view */
            #note {
                padding-left:0px;
                flex-flow: nowrap;
                display: flex;
                flex-direction: column;
            }
    
            #note ul{
                padding-left: 0;
                list-style: none;
            }
    
            #note ul > li{
                width: 20em;
                float: left;
                height: 250px;
                padding: 5px;
                font-size: 10px;
                line-height: 1;
                text-align: center;
            }
    
            #note .bg-silver {
                background: rgb(255, 255, 255) !important;
                border: 1px solid rgb(221, 221, 221);
            }
    
            #note .widget-stats.bg-silver .stats-link a{
                background: rgb(249, 249, 249);
            }
    
            #note .tags{
                border: none;
            }
    
            #note .fs-name i {
                color: rgb(153, 153, 153);
            }
    
            /* For list-view */
            #list {
                flex-flow: wrap;
                display: flex;
                align-content: flex-start;
            }
    
            #list ul{
                padding-left: 0;
                list-style: none;
            }
    
            #list ul > li{
                width: 20em;
                float: left;
                height: 250px;
                padding: 5px;
                font-size: 10px;
                line-height: 1;
                text-align: center;
            }
    
            #list .bg-silver {
                background: rgb(255, 255, 255) !important;
                border: 1px solid #f6f6f6;
            }
    
            #list .widget-stats.bg-silver .stats-link a{
                background: rgb(249, 249, 249);
            }
    
            #list .tags{
                border: none;
            }
    
            #list .fs-name i {
                color: rgb(153, 153, 153);
            }
    
    
            /* For grid-view */
            #grid ul{
                padding-left: 0;
                list-style: none;
            }
    
            #grid ul > li{
                float: left;
                width: 10em;
                height: 105px;
                font-size: 10px;
                line-height: 1.4;
                text-align: center;
                background-color: rgb(249, 249, 249);
                border: 1px solid rgb(255, 255, 255);
                margin: 5px 5px 0px 0px;
            }
    
    
            #fs-deploy-icon-list ul,
            #icon-list ul{
                padding-left: 0;
                list-style: none;
            }
    
            #fs-deploy-icon-list ul > li,
            #icon-list ul > li{
                float: left;
                width: 7.3em;
                height: 115px;
                padding: 10px;
                font-size: 10px;
                line-height: 1.4;
                text-align: center;
                background-color: rgb(249, 249, 249);
                border: 1px solid rgb(255, 255, 255);
            }
    
            .media-object {
                width: 48px;
                height: 48px;
            }
    
            /*
            *   File Upload
            */
            .progress {
                height: 18px;
                border-radius: 0px;
                display: block;
                position: relative;
                bottom: 16px;
            }
    
            .progress small {
                color: #444444;
                width: 100%;
                position: absolute;
                z-index: 10;
                top: 0;
                left: 0;
            }
    
            #files ul{
                margin: 10px;
                padding-left: 0;
                list-style: none;
            }
    
            #files ul > li{
                float: left;
                width: 100pt;
                height: 100px;
                font-size: 12px;
                line-height: 1.4;
                text-align: center;
                background-color: rgb(249, 249, 249);
                border: 1px solid rgb(255, 255, 255);
                padding-top: 5px;
                margin: 5px 0px 20px 5px;
            }
    
            #files ul > li > canvas {
                height: 65%;
                width: auto;
            }
    
            #files ul > li > a {
                background-color: rgb(249, 249, 249);
                border-radius: 0px;
            }
    
            #files ul > li > button {
                margin-top: -50px;
            }
    
            #files ul > li > .preview-null {
                width: 100px;
                padding-top: 10px;
                height: 64px;
                color: rgb(221, 221, 221);
            }
    
            .preview-img-responsive{
                max-width: 100%;
                height: auto;
                display: block;
            }
    
            .fs-view-component #grid,
            .fs-view-component .dataTables_scroll{
                height: 75vh;
                overflow: auto;
                padding: 0 10px;
            }
    
            .fs-name {
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
            }
    
    
            /* For view-container */
            .note-view,
            .list-view,
            .grid-view,
            .table-view{
                overflow: auto;
                height: calc(100vh - 185px);/* 70vh; */
            }
            
            .fs-view-component{
                height: 100%;
            }

            .el-icon-caret-right:before{
                color: #333333;
            }

            /* el tabs */
            .el-tabs__item {
                height: 30px;
                line-height: 30px;
                font-size: 12px;
            }
            .el-tabs__nav-prev,
            .el-tabs__nav-next{
                line-height: 30px;
            }

            .el-card__header{
                padding:0 5px;
            }
            .el-card__header > .clearfix > span {
                font-size: 14px;
                font-weight: 600;
            }
            
            .el-tabs--border-card{
                border:none;
                -webkit-box-shadow:unset;
                box-shadow:unset;
            }

            .el-tabs--border-card>.el-tabs__header {
                border-bottom: unset;
            }

            .el-tabs--border-card>.el-tabs__header .el-tabs__item.is-active {
                border-right-color: #ffffff;
                border-left-color: #ffffff;
            }

            .el-tree-node__content:hover {
                background-color: #f6f6f6;
            }
            .el-tree-node:focus>.el-tree-node__content {
                background-color: #b2dcfa;
            }

            /* fs-view-node */
            .fs-view-node .el-checkbox__input{
                float:right;
            }
            .fs-view-node .el-checkbox__label{
                display: none;
            }
            .fs-view-node .el-checkbox__input > .el-checkbox__inner{
                border:unset;
            }
            
    
        </style>
    
        
        /*----------  最外层element会自动增加组件同名 class="fs-view-component"  ----------*/
        <template>
            <el-container>
                <el-header style="padding:0 10px;height:50px;line-heigh:50px;margin-bottom:10px;">
                    <el-row>
                        <el-col :span="24">
                            <el-breadcrumb separator-class="el-icon-arrow-right">
                                <el-breadcrumb-item>
                                    <el-button type="text" @click="openIt(null,'/')">${rootName}</el-button>
                                </el-breadcrumb-item>
                                <el-breadcrumb-item  v-for="(item,index) in filePath" v-if="index > 0">
                                    <el-button type="text" @click="openIt(item, filePath.slice(0,index+1).join('/'))">${item}</el-button>
                                </el-breadcrumb-item>
                            </el-breadcrumb>
                        </el-col>
                    </el-row>
                
                    <el-row>
                        <el-col :span="24">
                            <div style="padding:0px;text-align:right;height:30px;line-height:30px;width:100%;">
    
                                <el-tooltip content="格子视图" placement="top">
                                    <el-button type="text" @click="currentView='list-view'" icon="el-icon-picture">
                                    </el-button>
                                </el-tooltip>
                                <el-tooltip content="列表视图" placement="top">
                                    <el-button type="text" @click="currentView='grid-view'" icon="el-icon-s-grid">
                                    </el-button>
                                </el-tooltip>
                                <el-tooltip content="表格视图" placement="top">
                                    <el-button type="text" @click="currentView='table-view'" icon="el-icon-menu">
                                    </el-button>
                                </el-tooltip>

                                <el-tooltip content="刷新" placement="top">
                                    <el-button type="text" @click="load();refreshTree();" icon="el-icon-refresh">
                                    </el-button>
                                </el-tooltip>

                                <el-tooltip content="排序" placement="top">
                                    <el-dropdown @command="onOrderCommand" style="margin-left: 5px;">
                                        <span class="el-dropdown-link">
                                          <el-button type="text" icon="el-icon-sort"></el-button>
                                        </span>
                                        <el-dropdown-menu slot="dropdown">
                                          <el-dropdown-item command='{"prop":"name","type":"asc"}'>按名称升序</el-dropdown-item>
                                          <el-dropdown-item command='{"prop":"name","type":"desc"}'>按名称降序</el-dropdown-item>
                                          <el-dropdown-item command='{"prop":"vtime","type":"asc"}'>按时间升序</el-dropdown-item>
                                          <el-dropdown-item command='{"prop":"vtime","type":"desc"}'>按时间降序</el-dropdown-item>
                                          <el-dropdown-item command='{"prop":"ftype","type":"asc"}'>按类型排序</el-dropdown-item>
                                        </el-dropdown-menu>
                                      </el-dropdown>
                                </el-tooltip>
    
                                <el-tooltip content="新建目录" placement="top">
                                    <el-button type="text" @click="newDir" icon="el-icon-folder-add" style="margin-left: 5px;">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip content="新建文件" placement="top">
                                    <el-button type="text" @click="newFile" icon="el-icon-document-add">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip :content="_.isEmpty(selectedItem)?'选择所有':'取消选择'" placement="top">
                                    <el-button type="text" @click="selectAll" :icon="_.isEmpty(selectedItem)?'el-icon-folder-checked':'el-icon-document-remove'">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip content="复制到" placement="top">
                                    <el-button type="text" @click="copyTo" icon="el-icon-document-copy">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip content="移动到" placement="top">
                                    <el-button type="text" @click="moveTo" icon="el-icon-shopping-cart-full">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip content="删除" placement="top">
                                    <el-button type="text" @click="deleteThem" icon="el-icon-delete">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip content="上传文件" placement="top">
                                    <el-button type="text" class="fileinput-button" style="color:#16e216;" icon="el-icon-upload">
                                        <input id="file-upload" type="file" name="uploadfile" multiple>
                                    </el-button>
                                </el-tooltip>
                                <el-tooltip content="导出备份" placement="top">
                                    <el-button type="text" @click="exportIt(rootPath)" icon="el-icon-download">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip content="导入恢复" placement="top">
                                    <el-button type="text" class="fileinput-button" icon="el-icon-upload2">
                                        <input type="file" name="loadfile" multiple @change="importIt">
                                    </el-button>
                                </el-tooltip>
    
                                <el-tooltip content="版本同步" placement="top">
                                    <el-button type="text" @click="syncIt" icon="el-icon-attract">
                                    </el-button>
                                </el-tooltip>
    
                            </div>
                        </el-col>
                    </el-row>
                </el-header>
                <el-main style="padding:0 5px;overflow:hidden;" ref="contentRef">
                    <component v-bind:is="currentView" :model.sync="model" @dblclick.native="resetStatus"></component>
                </el-main>
                <el-footer style="padding:0 10px;height:30px;line-height:30px;">
                    <small>数量：${model.length}  | 已选中：${selectedItem.length} </small>
                </el-footer>
            </el-container>>
    
        </template>
    
        /*----------  id是vue组件的name，内容是vue组件的option参数  ----------*/
        <script id="fs-view-component">
        {
            delimiters: ['${', '}'],
            props: {
                id: String,
                root: String,
                rootName: String,
                defaultView: String
            },
            data() {
    
                Vue.component('note-view',{
                    delimiters: ['#{', '}#'],
                    props: {
                        model: Array
                    },
                    template: `<div id="note">
                                   <ul>
                                      <li :class="item.ftype=='dir'?'dir fs-node context-menu-file':'fs-node context-menu-file'"
                                           :id="'fs_node_'+item.id"
                                           style="cursor: pointer;"
                                           :title="item.name"
                                           v-for="item in model">
                                          <div class="widget widget-stats bg-silver animated flipInX" 
                                                :id="'fs_node_widget_'+item.id" 
                                                @click="eventHub.$emit('FS-NODE-OPENIT-EVENT',item, item.parent+'/'+item.name)" 
                                                @dblclick="eventHub.$emit('FS-NODE-OPENIT-EVENT',item, item.parent+'/'+item.name)">
                                              <div class="stats-info">
                                                  <p><img class="media-object" :src="item | pickIcon" onerror="this.src='${window.ASSETS_ICON}files/png/dir.png?type=open&issys=${window.SignedUser_IsAdmin}';"></p>
                                              </div>
                                              <div class="stats-link">
                                                  <a class="fs-name" :data-pk="item.id" href="javascript:void(0);" style="text-align: left;margin:15px -15px -15px -15px;padding: 10px;" :title="item.title" :data-info="JSON.stringify(item)">
                                                      <p style="margin: 0 0 8.5px;"><i class="fas fa-plug"></i>  名称：#{item.name}#</p>
                                                      <p style="margin: 0 0 8.5px;"><i class="fas fa-user"></i>  作者：#{item|pickAuthor}# </p>
                                                      <p style="margin: 0 0 8.5px;"><i class="fas fa-clock"></i> 创建：#{moment(item.vtime).format("YYYY-MM-DD hh:mm:ss")}# </p>
                                                      <!--<p><i class="fas fa-tree"></i>  类型：#{item.ftype=='dir'?'目录':item.ftype}#</p>-->
                                                      <p style="margin: 0 0 8.5px;"><i class="fas fa-tags"></i>  标签：<input type="text" class="tags" name="tags" :value="item|pickTags"></p>
                                                      <p style="margin: 0 0 8.5px;"><i class="fab fa-readme"></i>  描述：#{item|pickRemark}#</p>
                                                  </a>
                                              </div>
                                              <div class="list-context-menu" :data-item="JSON.stringify(item)" style="position: absolute;right: 10px;top: 5px;cursor:pointer;">
                                                  <i class="fa fa-bars"></i>
                                              </div>
                                          </div>
                                      </li>
                                  </ul></div>`,
                    data:function(){
                        return {}
                    },
                    filters: {
                        pickName: function(item){
    
                            if (_.isEmpty(item)) return '';
    
                            let _name = _.head(item.name.split("."));
    
                            if(!_.isEmpty(_name)){
                                _name = _.truncate(_name, {
                                    'length': 9
                                });
                            }
    
                            return _name;
                        },
                        pickIcon: function(item){
    
                            // extend || ...
                            if( item.fullname === '/extend' ){
                                return `${window.ASSETS_ICON}/files/png/dir-lock.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            } else {
    
                                try{
                                    return _.attempt(JSON.parse.bind(null, item.attr)).icon || `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                                catch(error){
                                    return `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                            }
    
                        },
                        pickTags: function(item){
    
                            if(item.tags){
                                return item.tags.join(",");
                            } else {
                                return "";
                            }
                        },
                        pickAuthor: function(item){
                            if (!_.isEmpty(item.attr) && !_.isEqual(item.attr, 'null')) {
                                return _.attempt(JSON.parse.bind(null, item.attr)).author;
                            } else {
                                return "";
                            }
                        },
                        pickRemark: function(item){
                            if (!_.isEmpty(item.attr) && !_.isEqual(item.attr, 'null')) {
                                return _.attempt(JSON.parse.bind(null, item.attr)).remark;
                            } else {
                                return "";
                            }
                        }
                    },
                    watch:{
                        model:{
                            handler:function(val,oldVal){
                                const me = this;
    
                                let tagify = $('input[name=tags]').data("tagify");
                                
                                if(tagify){
                                    tagify.removeAllTags.bind(tagify);
                                }
                                
                                me.init();
    
                            },
                            deep:true
                        }
                    },
                    mounted: function(){
    
                        const me = this;
    
                        me.init();
    
                    },
                    methods: {
                        init:function(){
                            const me = this;
    
                            // init Tagify script on the above inputs
                            $('input[name=tags]').tagify()
                                .on('add', me.onAddTag)
                                .on('remove', me.onRemoveTag);
                        },
                        onAddTag: function(event,tagName){
                            const me = this;
    
                            let item = $(event.currentTarget).parent().parent().data("info");
    
                            let input = {class: item.class, action: "+", tag: tagName.value, id: item.id};
                            let rtn = fsHandler.callFsJScript("/matrix/tags/tag_service.js", encodeURIComponent(JSON.stringify(input)));
    
                            if(rtn.status == 'ok'){
                                me.$parent.init();
                            }
    
                        },
                        onRemoveTag: function(event,tagName){
                            const me = this;
                            let item = $(event.currentTarget).parent().parent().data("info");
                            let input = {class: item.class, action: "-", tag: tagName.value, id: item.id};
                            let rtn = fsHandler.callFsJScript("/matrix/tags/tag_service.js", encodeURIComponent(JSON.stringify(input)));
    
                            if(rtn.status == 'ok'){
                                me.$parent.init();
                            }
    
                        }
    
                    }
                });
                
                Vue.component('thumbnail-view',{
                    delimiters: ['#{', '}#'],
                    props: {
                        model: Array
                    },
                    template:   `<el-checkbox-group v-model="$root.$refs.viewRef.$children[0].selectedItem" class="fs-view-node">
                                    <el-button type="default" 
                                            style="max-width: 25em;width: 25em;height:auto;border-radius: 10px!important;margin: 5px;border: unset;box-shadow: 0 0px 5px 0 rgba(0, 0, 0, 0.05);"
                                            @dblclick.native="eventHub.$emit('FS-NODE-OPENIT-EVENT',item, item.parent+'/'+item.name)"
                                            v-for="item in model">
                                            <div style="position: relative;right: -100px;">    
                                                <el-dropdown trigger="hover" placement="top-start" @command="$root.$refs.viewRef.$children[0].onMenuCommand">
                                                        <span class="el-dropdown-link">
                                                            <i class="el-icon-arrow-down el-icon--right"></i>
                                                        </span>
                                                        <el-dropdown-menu slot="dropdown">
                                                            <el-dropdown-item :command="{fun:menuItem.fun,param:item,type:menuItem.type?menuItem.type:false}" v-for="menuItem in $root.$refs.viewRef.$children[0].getMenuModel(item)">#{menuItem.name}#</el-dropdown-item>
                                                        </el-dropdown-menu>
                                                </el-dropdown>
                                            </div>
                                            <el-image style="width:64px;margin:5px;" :src="item | pickIcon"></el-image>
                                            
                                            <div>
                                                <el-popover
                                                        placement="top-start"
                                                        trigger="hover"
                                                        open-delay="1000"
                                                        :content="item.name">
                                                    <p slot="reference" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">
                                                        名称：#{item.name}#
                                                    </p>
                                                </el-popover>
                                                <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">作者：#{item|pickAuthor}#</p>
                                                <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">创建：#{moment(item.vtime).format("YYYY-MM-DD hh:mm:ss")}#</p>
                                                <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">
                                                    标签：#{item.tags}#
                                                </p>
                                                <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">描述：#{item|pickRemark}#</p>
                                            </div>
                                            <el-checkbox :label="item.id"></el-checkbox>
                                    </el-button>
                                </el-checkbox-group>`,
                    data(){
                        return {
                            
                        }
                    },
                    filters: {
                        pickName: function(item){
    
                            if (_.isEmpty(item)) return '';
    
                            let _name = _.head(item.name.split("."));
    
                            if(!_.isEmpty(_name)){
                                _name = _.truncate(_name, {
                                    'length': 9
                                });
                            }
    
                            return _name;
                        },
                        pickIcon: function(item){
                            // extend || ...
                            if( item.fullname === '/extend' ){
                                return `${window.ASSETS_ICON}/files/png/dir-lock.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            } else {
    
                                try {
                                    return _.attempt(JSON.parse.bind(null, item.attr)).icon || `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                                catch(error){
                                    return `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                            }
    
                        },
                        pickTags: function(item){
    
                            if(item.tags){
                                return item.tags.join(",");
                            } else {
                                return "";
                            }
                        },
                        pickAuthor: function(item){
                            if (!_.isEmpty(item.attr) || !_.isEqual(item.attr, 'null')) {
                                return _.attempt(JSON.parse.bind(null, item.attr)).author;
                            }
                        },
                        pickRemark: function(item){
                            if (!_.isEmpty(item.attr) || !_.isEqual(item.attr, 'null')) {
                                return _.attempt(JSON.parse.bind(null, item.attr)).remark;
                            }
                        }
                    },
                    watch:{
                      model:{
                          handler:function(val,oldVal){
                              const me = this;
    
                              let tagify = $('input[name=tags]').data("tagify");

                              if(tagify){
                                tagify.removeAllTags.bind(tagify);
                              }
                              me.init();
    
                          },
                          deep:true
                      }
                    },
                    mounted(){
                        this.init();
                    },
                    methods: {
                        init(){
                            const me = this;
    
                            // init Tagify script on the above inputs
                            $('input[name=tags]').tagify()
                                      .on('add', me.onAddTag)
                                      .on('remove', me.onRemoveTag);
                        },
                        onAddTag(event,tagName){
                            const me = this;
    
                            let item = $(event.currentTarget).parent().parent().data("info");
    
                            let input = {class: item.class, action: "+", tag: tagName.value, id: item.id};
                            let rtn = fsHandler.callFsJScript("/matrix/tags/tag_service.js", encodeURIComponent(JSON.stringify(input)));
    
                            if(rtn.status == 'ok'){
                                me.$parent.init();
                            }
    
                        },
                        onRemoveTag(event,tagName){
                            const me = this;
                            let item = $(event.currentTarget).parent().parent().data("info");
                            let input = {class: item.class, action: "-", tag: tagName.value, id: item.id};
                            let rtn = fsHandler.callFsJScript("/matrix/tags/tag_service.js", encodeURIComponent(JSON.stringify(input)));
    
                            if(rtn.status == 'ok'){
                                me.$parent.init();
                            }
    
                        }
    
                    }
                });
    
                Vue.component('list-view',{
                    delimiters: ['#{', '}#'],
                    props: {
                        model: Array
                    },
                    template:   `<div id="list">
                                    <el-checkbox-group v-model="$root.$refs.viewRef.$children[0].selectedItem" class="fs-view-node">
                                        <el-button type="default" 
                                                style="max-width: 20em;width: 20em;height:auto;border-radius: 10px!important;margin: 5px;border: unset;box-shadow: 0 0px 5px 0 rgba(0, 0, 0, 0.05);"
                                                @dblclick.native="eventHub.$emit('FS-NODE-OPENIT-EVENT',item, item.parent+'/'+item.name)"
                                                v-for="item in model">
                                                <div style="position: relative;right: -100px;">    
                                                    <el-dropdown trigger="hover" placement="top-start" @command="$root.$refs.viewRef.$children[0].onMenuCommand">
                                                            <span class="el-dropdown-link">
                                                                <i class="el-icon-arrow-down el-icon--right"></i>
                                                            </span>
                                                            <el-dropdown-menu slot="dropdown">
                                                                <el-dropdown-item :command="{fun:menuItem.fun,param:item,type:menuItem.type?menuItem.type:false}" v-for="menuItem in $root.$refs.viewRef.$children[0].getMenuModel(item)">#{menuItem.name}#</el-dropdown-item>
                                                            </el-dropdown-menu>
                                                    </el-dropdown>
                                                </div>
                                                <el-image style="width:64px;margin:5px;" :src="item | pickIcon"></el-image>
                                                <div>
                                                    <el-popover
                                                            placement="top-start"
                                                            trigger="hover"
                                                            open-delay="1000"
                                                            :content="item.name">
                                                        <p slot="reference" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">
                                                            名称：#{item.name}#
                                                        </p>
                                                    </el-popover>
                                                    <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">作者：#{item|pickAuthor}#</p>
                                                    <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">创建：#{moment(item.vtime).format("YYYY-MM-DD hh:mm:ss")}#</p>
                                                    <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">
                                                        标签：#{item.tags}#
                                                    </p>
                                                    <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:left;">描述：#{item|pickRemark}#</p>
                                                </div>
                                                <el-checkbox :label="item.id"></el-checkbox>
                                        </el-button>
                                    </el-checkbox-group>
                                </div>`,
                    data(){
                        return {
                            
                        }
                    },
                    filters: {
                        pickName: function(item){
    
                            if (_.isEmpty(item)) return '';
    
                            let _name = _.head(item.name.split("."));
    
                            if(!_.isEmpty(_name)){
                                _name = _.truncate(_name, {
                                    'length': 9
                                });
                            }
    
                            return _name;
                        },
                        pickIcon: function(item){
                            // extend || ...
                            if( item.fullname === '/extend' ){
                                return `${window.ASSETS_ICON}/files/png/dir-lock.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            } else {
    
                                try {
                                    return _.attempt(JSON.parse.bind(null, item.attr)).icon || `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                                catch(error){
                                    return `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                            }
    
                        },
                        pickTags: function(item){
    
                            if(item.tags){
                                return item.tags.join(",");
                            } else {
                                return "";
                            }
                        },
                        pickAuthor: function(item){
                            if (!_.isEmpty(item.attr) || !_.isEqual(item.attr, 'null')) {
                                return _.attempt(JSON.parse.bind(null, item.attr)).author;
                            }
                        },
                        pickRemark: function(item){
                            if (!_.isEmpty(item.attr) || !_.isEqual(item.attr, 'null')) {
                                return _.attempt(JSON.parse.bind(null, item.attr)).remark;
                            }
                        }
                    },
                    watch:{
                      model:{
                          handler:function(val,oldVal){
                              const me = this;
    
                              let tagify = $('input[name=tags]').data("tagify");

                              if(tagify){
                                tagify.removeAllTags.bind(tagify);
                              }
                              me.init();
    
                          },
                          deep:true
                      }
                    },
                    mounted(){
                        this.init();
                    },
                    methods: {
                        init(){
                            const me = this;
    
                            // init Tagify script on the above inputs
                            $('input[name=tags]').tagify()
                                      .on('add', me.onAddTag)
                                      .on('remove', me.onRemoveTag);
                        },
                        onAddTag(event,tagName){
                            const me = this;
    
                            let item = $(event.currentTarget).parent().parent().data("info");
    
                            let input = {class: item.class, action: "+", tag: tagName.value, id: item.id};
                            let rtn = fsHandler.callFsJScript("/matrix/tags/tag_service.js", encodeURIComponent(JSON.stringify(input)));
    
                            if(rtn.status == 'ok'){
                                me.$parent.init();
                            }
    
                        },
                        onRemoveTag(event,tagName){
                            const me = this;
                            let item = $(event.currentTarget).parent().parent().data("info");
                            let input = {class: item.class, action: "-", tag: tagName.value, id: item.id};
                            let rtn = fsHandler.callFsJScript("/matrix/tags/tag_service.js", encodeURIComponent(JSON.stringify(input)));
    
                            if(rtn.status == 'ok'){
                                me.$parent.init();
                            }
    
                        }
    
                    }
                });
    
                Vue.component('grid-view',{
                    delimiters: ['#{', '}#'],
                    props: {
                        model: Array
                    },
                    data(){
                        return {

                        }
                    },
                    template:   `<div id="grid">
                                    <el-checkbox-group v-model="$root.$refs.viewRef.$children[0].selectedItem" class="fs-view-node">
                                        <el-button type="default" 
                                                style="max-width: 12em;width: 12em;height:110px;border-radius: 10px!important;margin: 5px;border: unset;box-shadow: 0 0px 5px 0 rgba(0, 0, 0, 0.05);"
                                                @dblclick.native="eventHub.$emit('FS-NODE-OPENIT-EVENT',item, item.parent+'/'+item.name)"
                                                v-for="item in model">
                                                <div style="position: relative;right: -40px;">    
                                                    <el-dropdown trigger="hover" placement="top-start" @command="$root.$refs.viewRef.$children[0].onMenuCommand">
                                                            <span class="el-dropdown-link">
                                                                <i class="el-icon-arrow-down el-icon--right"></i>
                                                            </span>
                                                            <el-dropdown-menu slot="dropdown">
                                                                <el-dropdown-item :command="{fun:menuItem.fun,param:item,type:menuItem.type?menuItem.type:false}" v-for="menuItem in $root.$refs.viewRef.$children[0].getMenuModel(item)">
                                                                    #{menuItem.name}#
                                                                </el-dropdown-item>
                                                            </el-dropdown-menu>
                                                    </el-dropdown>
                                                </div>
                                                <el-image style="width:34px;margin:5px;" :src="item | pickIcon"></el-image>
                                                <div>
                                                    <p style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:5px;text-align:center;">
                                                        #{item.name}#
                                                    </p>
                                                </div>
                                                <el-checkbox :label="item.id"></el-checkbox>
                                        </el-button>
                                    </el-checkbox-group>
                                </div>`,
                    filters: {
                        pickIcon(item){
    
                            // extend || ...
                            if( item.fullname === '/extend' ){
                                return `${window.ASSETS_ICON}/files/png/dir-lock.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                            } else {
                                try{
                                    if(_.includes(['png','jpeg'],item.ftype)){
                                        return `/fs${item.parent}/${item.name}?type=open&issys=${window.SignedUser_IsAdmin}`;    
                                    } else {
                                        return _.attempt(JSON.parse.bind(null, item.attr)).icon || `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                    }
                                }
                                catch(error){
                                    return `${window.ASSETS_ICON}/files/png/${item.ftype}.png?type=open&issys=${window.SignedUser_IsAdmin}`;
                                }
                            }
                        }
                    }
                });
    
                Vue.component('table-view',{
                    delimiters: ['#{', '}#'],
                    props: {
                        model: Array
                    },
                    data(){
                        return {
                            dt:{
                                rows: [],
                                columns: []
                            }
                        }
                    },
                    template:   `<el-table style="width: 100%"
                                    :data="model"
                                    stripe
                                    @selection-change="onSelectionChange">
                                    <el-table-column type="selection" align="center"></el-table-column> 
                                    <el-table-column
                                        sortable 
                                        show-overflow-tooltip
                                        v-for="(item,index) in dt.columns"
                                        :key="index"
                                        :prop="item.field"
                                        :label="item ? item.title : ''"
                                        :width="item.width"
                                        v-if="item.visible">
                                            <template slot-scope="scope">
                                                <div v-html='item.render(scope.row, scope.column, scope.row[item.field], scope.$index)' 
                                                    v-if="typeof item.render === 'function'">
                                                </div>
                                                <div v-else-if="item.field==='name'">
                                                    <el-link type="info" :underline="false" @click.native.prevent="forward(scope.row)" >#{scope.row[item.field]}#</el-link>
                                                </div>
                                                <div v-else>
                                                    #{scope.row[item.field]}#
                                                </div>
                                                
                                            </template>
                                    </el-table-column>
                                </el-table>`,
                    created(){
                        let tmp = fsHandler.callFsJScript("/matrix/fs/fs_data.js", null).message.columns;
                        _.extend(this.dt, {columns: _.map(tmp, function(v){
                                    
                            if(_.isUndefined(v.visible)){
                                _.extend(v, { visible: true });
                            }

                            if(!v.render){
                                return v;
                            } else {
                                return _.extend(v, { render: eval(v.render) });
                            }
                            
                        })});
                        
                        _.extend(this.dt, { rows:this.model } );
                    },
                    methods:{
                        forward(row){
                            eventHub.$emit('FS-NODE-OPENIT-EVENT',row, row.parent+'/'+row.name)
                        },  
                        onCellClick(row,column,cell,event){

                        },
                        onSelectionChange(val){
                            this.$root.$refs.viewRef.$children[0].selectedItem = _.map(val,'id');
                        }
                    }
                });
    
                Vue.component('fs-editor-view-by-html',{
                    props:{
                        id: String
                    },
                    template:   `<div class="embed-responsive embed-responsive-16by9" style="overflow-y:auto;">
                                    <iframe class="embed-responsive-item" :src="src"></iframe>
                                </div>`,
                    data(){
                        return {
                            src: ""
                        }
                    },
                    watch: {
                        src(val, oldVal) {
                            document.getElementsByTagName('iframe')[0].src = val;
                        }
                    },
                    created() {
                        eventHub.$on(`FS-EDITOR-RUN-EVENT-${this.id}`, this.setSrc)
                    },
                    methods: {
                        setSrc(event) {
                            this.src = event;
                        }
                    }
                })
    
                Vue.component('fs-editor-view-by-other',{
                    delimiters: ['#{', '}#'],
                    props:{
                        id: String,
                        output: Object
                    },
                    template: `<fs-output-component :id="'editor-output-'+id" :bid="id"
                                    :model="model"
                                    showToolsBar="false"
                                    showStatusBar="false"></fs-output-component>`,
                    data(){
                        return{
                            model: {
                                oldInput: "",
                                newInput: "",
                                mode: "json",
                                theme: "tomorrow",
                                printMargin: false,
                                readOnly: false,
                            }
                        }
                    },
                    watch: {
                        output: {
                            handler(val,oldVal){
                                _.extend(this.model,{newInput: JSON.stringify(this.output, null, 2)});
                                //eventHub.$on(`FS-EDITOR-RUN-EVENT-${this.id}`, this.setData)
                                //this.setData(val);
                            },
                            deep:true,
                            immediate:true
                        }
                    },
                    mounted() {
                        const self = this;
    
                        self.$nextTick(function () {
                            self.init();
                        })
                    },
                    methods: {
                        init() {
                            const self = this;
    
                            let rtn = fsHandler.callFsJScript(item.name, '');
    
                            self.model.newInput = JSON.stringify(rtn.message, null, 4);
                        },
                        setData(event) {
                            const self = this;
                            
                            if(event.message) {
                                
                                if (typeof event.message === 'object') {
                                    _.extend( self.model, {newInput: JSON.stringify(event.message, null, 2)} );
                                } else {
                                    _.extend( self.model, {newInput: JSON.stringify(event.message, null, 4)} );
                                }
    
                            } else {
                                _.extend( self.model, {newInput: event} );
                            }
                        }
                    }
    
                })
                
                // 日志
                Vue.component('fs-editor-log-console',{
                    delimiters: ['${', '}'],
                    props: {
                        //规则名称
                        id: String   
                    },
                    template:   `<el-container>
                                    <el-header style="height:30px;line-height:30px;padding:5px 30px;">
                                        <el-tooltip content="清空" open-delay="500">
                                            <el-button type="text" @click="onReset"><i class="fas fa-trash"></i></el-button>
                                        </el-tooltip>
                                        <el-tooltip content="重新加载" open-delay="500">
                                            <el-button type="text" @click="onLoad"><i class="fas fa-sync"></i></el-button>
                                        </el-tooltip>
                                    </el-header>
                                    <el-main>
                                        <el-table :data="rows" style="width: 100%" max-height="200" stripe :default-sort="{prop: 'vtime', order: 'descending'}" 
                                                :row-class-name="rowClassName"
                                                :header-cell-style="headerRender"
                                                @selection-change="handleSelectionChange">
                                            <el-table-column type="selection" width="55"></el-table-column>                                                
                                            <el-table-column :label="item.title" 
                                                            :prop="item.data" 
                                                            v-for="(item,index) in columns" 
                                                            :formatter="item.render" 
                                                            sortable 
                                                            :width="item.width"
                                                            v-if="item.visible">
                                            </el-table-column>
                                            <!--el-table-column align="right">
                                                <template slot="header" slot-scope="scope">
                                                    <el-input size="mini" placeholder="输入关键字搜索"/>
                                                </template>
                                            </el-table-column-->
                                        </el-table>
                                    </el-main>
                                </el-container>`,
                    data(){
                        return {
                            rows: [],
                            columns: [],
                            selectedRows: [],
                            ifDeleteVersionData: false
                        }
                    },
                    created(){
                        let rtn = fsHandler.callFsJScript("/matrix/fs/log-by-name.js", encodeURIComponent(this.id)).message;
                        this.rows = rtn.rows;
                        this.columns = _.map(rtn.columns,function(v){
                                            if(v.render){
                                                v.render = eval(v.render);
                                            }
                                            return v;
                                        });
                        
                        // 更新DataTable
                        eventHub.$on("FS-LOG-UPDATE-EVENT",()=>{
                            let rtn = fsHandler.callFsJScript("/matrix/config/fs-by-name.js", encodeURIComponent(this.id)).message;
                            this.rows = rtn.rows;
                        })
                    },
                    methods:{
                        rowClassName({row, rowIndex}){
                            return `row-${rowIndex}`;
                        },
                        headerRender({ row, column, rowIndex, columnIndex }){
                            if (rowIndex === 0) {
                                //return 'text-align:center;';
                            }
                        },
                        onReset(){
                            let item = {class:"/matrix/consolelog/scriptjs", ids: _.map(this.selectedRows,'id').join("', '"), ifDeleteVersionData: self.ifDeleteVersionData}
                            let act = fsHandler.callFsJScript("/matrix/fs/action-by-delete.js",encodeURIComponent(JSON.stringify(item))).message;
                            _.delay(()=>{
                                let rtn = fsHandler.callFsJScript("/matrix/fs/log-by-name.js", encodeURIComponent(this.id)).message;
                                this.rows = rtn.rows;
                            })
                        },
                        onLoad(){
                            let rtn = fsHandler.callFsJScript("/matrix/fs/log-by-name.js", encodeURIComponent(this.id)).message;
                            this.rows = rtn.rows;
                        },
                        handleSelectionChange(val) {
                            this.selectedRows = val;
                        }
                    }
                })

                Vue.component("fs-editor-view",{
                    props:{
                        id: String,
                        item: Object
                    },
                    template: `<el-container style="height:100%;min-height:300px;">
                                    <el-main style="padding:1px 0px 0px 0px;overflow:hidden;" ref="mainView">
                                        <fs-editor-component :id="'editor-'+id" :bid="'output-'+id"
                                            :model="model"
                                            showToolsBar="false"
                                            showStatusBar="false"></fs-editor-component>
                                    </el-main>
                                    <el-footer style="background-color:#ddd;overflow:hidden;padding:0px;height:200px;" ref="footerView">
                                        <el-tabs value="result" type="border-card" style="height:100%;">
                                            <el-tab-pane label="日志" name="log" style="height:100%;">
                                                <fs-editor-log-console :id="item.fullname" v-if="!_.isEmpty(item)"></fs-editor-log-console> 
                                            </el-tab-pane>
                                            <el-tab-pane label="预览" name="result" style="height:100%;overflow:auto;padding-top: 1px;">
                                                <fs-editor-view-by-html :id="'output-'+id" :output="model.fs.output" v-if="item.ftype=='html'" style="height:100%;"></fs-editor-view-by-html>
                                                <fs-editor-view-by-other :id="'output-'+id" :output="model.fs.output" style="height:100%;" v-else></fs-editor-view-by-other>
                                            </el-tab-pane>
                                        </el-tabs>
                                    </el-footer>
                                </el-container>`,
                    data() {
                        return{
                            model: {
                                oldInput: "",
                                newInput: "",
                                mode: "javascript",
                                theme: "tomorrow",
                                printMargin: false,
                                readOnly: false
                            }
                        }
                    },
                    watch: {
                        item: {
                            handler(val,oldVal){
                                _.extend(this.model,{fs: val, mode: this.mode()});
                            },
                            deep: true,
                            immediate:true
                        }
                    },
                    mounted() {
                        this.init();
                        this.initSplit();
                    },
                    methods: {
                        init() {
                            let rtn = fsHandler.fsContent(this.item.parent, this.item.name);
    
                            _.extend(this.model, {newInput:rtn});
                            
                        },
                        initSplit(){
                            Split([this.$refs.mainView.$el, this.$refs.footerView.$el], {
                                sizes: [80, 20],
                                minSize: [0, 0],
                                gutterSize: 5,
                                cursor: 'row-resize',
                                direction: 'vertical',
                                onDragEnd:function(sizes) {
                                    eventHub.$emit(`LAYOUT-DATATABLE-RESIZE-EVENT`,sizes[1]);
                                }
                            });
                        },
                        // 应用扩展名影射不同的编辑模式
                        mode(){
                            let list = {js:'javascript', ltsv: 'toml', file: 'text', html: 'html', md: 'markdown', json: 'json', csv: 'csv'};
                            return list[this.item.ftype] || 'javascript';
                        }
                    }
    
                })
                
                return {
                    rootPath: this.root,
                    model: [],
                    selectedItem: [],
                    datatable: {},
                    upload:{
                        option: {
                            url: '/fs/temp',
                            dataType: 'json',
                            autoUpload: true,
                            acceptFileTypes: /(\.|\/)(gif|jpe?g|png|csv|log|pdf|html|txt|iso|mp3|mp4)$/i,
                            maxFileSize: 999*000,
                            disableImageResize: /Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),
                            previewMaxWidth: 100,
                            previewMaxHeight: 100,
                            previewCrop: true
                        }
                    },
                    action: {
                        from: null,
                        to: null
                    },
                    signedUserName: '',
                    currentView: ''
                }
            },
            created() {
                
                this.init();

                eventHub.$on("FS-NODE-LOAD-EVENT",this.load);
                eventHub.$on("FS-NODE-OPENIT-EVENT",this.openIt);
                eventHub.$on("FS-FORWARD-EVENT", this.openIt);
                eventHub.$on("PATH-CHANGE-EVENT", this.setRootPath);
            },
            mounted(){
                
                this.$nextTick().then(()=> {
                    this.initPlugIn();
                })
            },
            watch: {
                root: {
                    handler:function(val,oldVal){
                        this.rootPath = val;
                        this.load();
                    },
                    immediate:true
                },
                rootPath: function(val,oldVal){
                    
                    let _extName = _.split(val,'.');
    
                    this.load();
    
                    let _url = val.replace(/\/\//g,'/');
    
                    // system || extend || ... 判断第一级
                    if(window.SignedUser_IsAdmin){
                        _url += '?issys=true';
                    }
    
                    $('#file-upload').fileupload({url: `/fs${_url}`});
    
                }
            },
            computed: {
                filePath(){
                    return this.rootPath.split("/");
                }
            },
            methods: {
                init(){
                    this.load();
                    this.signedUserName = window.SignedUser_UserName;
                },
                initPlugIn(){
                    this.initFileUpload();

                    _.delay(()=>{
                        if(!_.isEmpty(this.defaultView)){
                            this.currentView = this.defaultView;
                        }
                    },100)
                },
                toggleView(view){
                    this.currentView = view;
                },
                getMenuModel(item){
                    // 根据文件类型返回右键菜单
                    let model = {
                        "js": [
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑/运行", icon: "fas fa-play", fun: "editIt" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "html": [
                            { name: "发布应用", icon: "fab fa-codepen", fun: "deployIt" },
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑", icon: "fas fa-edit", fun: "editIt" },
                            { name: "运行", icon: "fas fa-play", fun: "runHtml" },
                            { name: "运行链接", icon: "fas fa-map-marker-alt", fun: "copyUrl" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "htm": [
                            { name: "发布应用", icon: "fab fa-codepen", fun: "deployIt" },
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑", icon: "fas fa-edit", fun: "editIt" },
                            { name: "运行", icon: "fas fa-play", fun: "runHtml" },
                            { name: "运行链接", icon: "fas fa-map-marker-alt", fun: "copyUrl" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "md":[
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑", icon: "fas fa-edit", fun: "editIt" },
                            { name: "打开", icon: "fas fa-play", fun: "openIt", type: null },
                            { name: "打开链接", icon: "fas fa-map-marker-alt", fun: "copyUrl" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "json":[
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑", icon: "fas fa-edit", fun: "editIt" },
                            { name: "打开", icon: "fas fa-play", fun: "openIt", type: true },
                            { name: "打开链接", icon: "fas fa-map-marker-alt", fun: "copyUrl" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "imap":[
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑", icon: "fas fa-edit", fun: "editIt" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "ishow":[
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑", icon: "fas fa-edit", fun: "editIt" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "iflow":[
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "编辑", icon: "fas fa-edit", fun: "editIt" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "dir": [
                            { name: "打开", icon: "fas fa-folder-open", fun: "openIt" },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ],
                        "normal": [
                            { name: "打开", icon: "fas fa-folder-open", fun: "openIt" },
                            { name: "下载", icon: "fas fa-download", fun: "downloadIt", type: true },
                            { name: "删除", icon: "fas fa-trash", fun: "deleteIt", type: true },
                            { name: "共享", icon: "fas fa-share-square", fun: "shareIt" },
                            { name: "属性", icon: "fas fa-info", fun: "info" }
                        ]
                    };

                    try{
                        if(model[item.ftype]){
                            return model[item.ftype];
                        } else {
                            return model["normal"];
                        }
                    } catch(err){
                        return model["normal"];
                    } finally{
                        
                    }

                },
                onMenuCommand(cmd){
                    
                    if(!cmd.type){
                        this[cmd.fun](cmd.param);
                    } else {
                        this[cmd.fun](cmd.param,cmd.type);
                    }
                    
                },
                initEditName(){
                    
                    $(".fs-name[data-edit='true']").editable({
                        title: "重命名",
                        type: "text",
                        pk: $(this).data("pk"),
                        container: 'body',
                        validate: (value)=> {
                            if (!$.trim(value)) {
                                return '不能为空';
                            }
                        },
                        display: (value, sourceData)=> {
                            if(value.length > 10) {
                                $(this).html(_.split(value,"",9).join("")+"...");
                            }
                        },
                        success: (response,newValue)=> {
    
                            let _item = $(this).data("info");
    
                            let _old = _.trim(_item.parent + "/" + $(this).editable('getValue', true));
                            let _new = _.trim(_item.parent + "/" + newValue);
    
                            let _check = fsHandler.fsCheck( _item.parent, newValue);
                            if(_check) {
                                alertify.error("文件已存在，请确认！")
                                return false;
                            }
    
                            let _rtn = fsHandler.fsRename(_old, _new);
    
                            if(_rtn == 1){
                                this.load();
                            } else {
                                $(this).innerHTML($(this).editable('getValue', true));
                            }
                        }
                    });
    
                },
                initFileUpload(){
                    const self = this
                    let uploadButton = $('<button/>')
                        .css("background","#ddd")
                        .prop('disabled', true)
                        .text('准备中...')
                        .on('click', function () {
                            var $this = $(this),
                                data = $this.data();
                            $this
                                .off('click')
                                .text('中止')
                                .on('click', function () {
                                    $this.remove();
                                    data.abort();
                                });
                            data.submit().always(function () {
                                $this.remove();
                            });
                        });
    
                    $('#file-upload').fileupload(self.upload.option)
                        .on('fileuploadadd', function (e, data) {
    
                            let title = "上传";
    
                            let wnd = maxWindow.winUpload(title, '<div id="files" class="files"></div>', null,null);
    
                            // 更新信息栏信息
                            new Vue({
                                delimiters: ['#{', '}#'],
                                el: `#jsPanel-upload-footer-${objectHash.sha1(title)}`,
                                template: `<div style="width: 100%;"><i class="fas fa-clock"></i> #{stime}# | 上传文件：#{total}# </div>`,
                                data: {
                                    stime: moment().format("LLL"),
                                    utime: '',
                                    upload: 0,
                                    total: data.originalFiles.length,
                                    interval: null
                                },
                                created: function(){
                                    //eventHub.$on("UPLOAD-UPDATE-STATUS-EVENT",this.update);
    
                                    /*this.interval = setInterval(function(){
                                        this.utime = moment(this.stime).fromNow();
                                    },1000)*/
                                },
                                methods: {
                                    update: function(event){
    
                                        if(event.stop){
                                            //clearInterval(this.interval);
                                        }
    
                                        if(event.upload){
                                            this.upload += event.upload;
                                        }
    
                                    }
                                }
                            });
    
                            data.context = $('<ul/>').appendTo('#files');
    
                            $.each(data.files, function (index, file) {
    
                                let _name = file.name;
    
                                if(!_.isEmpty(file.name) && _.size(file.name) > 9){
                                    _name = _.split(file.name,"",9).join("")+"..."
                                }
    
                                var node = $('<li/>')
                                    .append($(`<p style="padding:0px;margin:0px;"><a href="#" style="border:none;-webkit-box-shadow: unset;box-shadow: unset;"/></p>`)
                                        .text(_name))
                                    .attr("title",file.name)
                                    .append($(`<div id="progress_${objectHash.sha1(file.name)}">
                                                    <progress></progress>
                                               </div>`));
                                if (!index) {
                                    node
                                        .append(uploadButton.clone(true).data(data));
                                }
                                node.appendTo(data.context);
                            });
                        })
                        .on('fileuploadprocessalways', function (e, data) {
                            var index = data.index,
                                file = data.files[index],
                                node = $(data.context.children()[index]);
    
                            if (file.preview) {
                                node
                                    .prepend(file.preview);
                            }else{
                                node
                                    .prepend(`<span class="fa fa-file fa-4x preview-null"></span>`);
                            }
    
                            if (file.error) {
                                node
                                    .append('<hr>')
                                    .append($('<span class="text-danger"/>').text(file.error));
                            }
                            if (index + 1 === data.files.length) {
                                data.context.find('button')
                                    .text('上传')
                                    .css('display','none')
                                    .prop('disabled', !!data.files.error);
                            }
    
                            //更新底部状态信息
                            //eventHub.$emit("UPLOAD-UPDATE-STATUS-EVENT",{total: null, etime: null, upload: index + 1})
                        })
                        .on('fileuploadprogress', function (e, data) {
    
                            let _name = objectHash.sha1(data.files[0].name);
                            let progress = parseInt(data.loaded / data.total * 100, 10);
                            $(`#progress_${_name} .progress-bar`).css(
                                'width',
                                progress + '%'
                            ).html(`<small>${parseInt(data.loaded/1024,10)} KB / ${parseInt(data.total/1024,10)} KB</small>`);
                        })
                        .on('fileuploaddone', function (e, data) {
    
                            $.each(data.files, function (index, file) {
    
                                if (file.name) {
                                    // var link = $('<a>')
                                    //     .attr('target', '_blank')
                                    //     .prop('href', file.url);
                                    // $(data.context.children()[index])
                                    //     .wrap(link);
                                    $(`#progress_${objectHash.sha1(file.name)} .progress-bar`).html(`<small>已完成</small>`);
                                } else if (file.error) {
                                    var error = $('<span class="text-danger"/>').text(file.error);
                                    $(data.context.children()[index])
                                        .append('<br>')
                                        .append(error);
                                }
                            });
    
                            self.load();
    
                            //更新底部状态信息
                            //eventHub.$emit("UPLOAD-UPDATE-STATUS-EVENT",{total: null, etime: _.now(), upload: 0, stop: true})
    
                            // close upload win
    
                        })
                        .on('fileuploadfail', function (e, data) {
                            $.each(data.files, function (index) {
                                var error = $('<span class="text-danger"/>').text('上传失败。');
                                $(data.context.children()[index])
                                    .append('<br>')
                                    .append(error);
                            });
                            // close upload win
    
                        })
                        .prop('disabled', !$.support.fileInput)
                        .parent().addClass($.support.fileInput ? undefined : 'disabled');
                },
                resetStatus(){
                    this.selectedItem = [];
                },
                openIt(item, path){
                    const self = this
                    console.log(88,item,path)
                    event.preventDefault();
    
                    // 点击【我的文件】返回不同的root
                    if(_.isNull(item)){
                        self.rootPath = self.root;
                        return;
                    }
    
                    if(typeof(item) === 'string' || item.ftype === 'dir'){
                        self.rootPath = path.replace(/\/\//g,'/');
                        return;
                    }
    
                    if(!_.isEmpty(item)){
    
                        if(_.includes(['png','jpg','jpeg','gif'], item.ftype)) {
    
    
                            let contents = `<img src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}" class="preview-img-responsive center-block" alt="Image">`;
                            let _wnd = maxWindow.winApp(item.name, contents, null,null);
    
                        } else if(_.includes(['mov','mp4','avi'], item.ftype)) {
    
                            let contents = `<div class="embed-responsive embed-responsive-16by9">
                                                <video src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}" controls="controls" autoplay>
                                                    your browser does not support the video tag
                                                </video>
                                            </div>
                                            `;
    
                            let _wnd = maxWindow.winApp(item.name, contents, null,null);
    
                        } else if(_.includes(['pdf'], item.ftype)) {
    
                            let contents = `<div class="embed-responsive embed-responsive-16by9">
                                                <iframe class="embed-responsive-item" src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}"></iframe>
                                            </div>`;
    
                            let _wnd = newWindow('fsapp', item.name, contents, null,null);
    
                        } else if(_.includes(['pptx','ppt'], item.ftype)) {
    
                            window.open(`/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}`, "_blank");
    
                        } else if(_.some(_.filter(mx.global.register.file,{type:"public"}), {value:item.ftype})) {
    
                           self.editIt(item);
    
                        } else if(_.includes(['swf'], item.ftype)) {
                            let contents = `<div class="embed-responsive embed-responsive-16by9">
                                                <video src="/fs${path}?type=open&issys=${window.SignedUser_IsAdmin}" width="100%" height="100%" controls="controls" autoplay>
                                                    Your browser does not support the video tag.
                                                </video>
                                            </div>`;
    
                            let _wnd = maxWindow.winApp(item.name, contents, null,null);
                        } else if(_.includes(['imap','iflow', 'ishow'], item.ftype)) {
    
                            _.merge(item,{action:'run'});
    
                            let url = fsHandler.genFsUrl(item,null,null);
    
                            window.open(url,'_blank');
                        } else if(_.includes(['md'], item.ftype)){
                            _.merge(item,{action:'run'});
    
                            let url = fsHandler.genFsUrl(item,{ header:true, sidebar:true, footbar:true },null);
    
                            window.open(url,'_blank');
                        }
                    }
    
                },
                runHtml(item){
                    let file = [item.parent, item.name].join("/");
                    window.open(`/fs${file}?issys=true&type=open&issys=${window.SignedUser_IsAdmin}`,'_blank');
                },
                copyUrl(item){
                    const self = this
    
                    let file = `/fs${[item.parent, item.name].join("/")}?type=open&issys=${window.SignedUser_IsAdmin}`;
    
                    if(_.includes(['md','imap','iflow','ishow'],item.ftype)){
                        _.merge(item,{action:'run'});
                        file = fsHandler.genFsUrl(item,{ header:true, sidebar:false, footbar:true },null);
                    }
    
                    alertify.set({ labels: {
                            ok     : "复制地址",
                            cancel : "取消"
                    }});
    
                    alertify.prompt("运行链接地址", function (e, str) {
                        // str is the input text
                        if (e) {
                            // user clicked "ok"
                            let clipboard = new Clipboard('.alertify-button-ok', {
                                text: function (trigger) {
                                    return str;
                                }
                            });
                        } else {
                            // user clicked "cancel"
                        }
                    }, file);
    
                    $(".alertify-prompt .alertify-message").css('height','5vh');
    
                },
                refreshTree(){
                    // 发送Tree刷新事件
                    eventHub.$emit("FS-TREE-REFRESH-EVENT");
                },
                load() {
                    
                    this.$nextTick().then(()=>{
                        
                        // 重置选择
                        this.selectedItem = [];
    
                        let _rtn = fsHandler.fsList(this.rootPath);

                        this.model = _.orderBy(_.map(_rtn,(v,k)=>{

                            return _.merge(v, {"username": `${this.signedUserName}`});

                        }),[v => v.name.toLowerCase(),"vtime"],["asc","desc"]);

                        _.delay(()=>{
                            // 刷新
                            this.refresh();
                        },100);  
                    })
    
                },
                refresh() {
                    // 重新实例化 editable
                    this.initEditName();
                },
                newDir() {
                    const self = this;
    
                    let _name = '新文件夹_' + _.now();
                    let _type = 'dir';
                    let _attr = {remark: '', ctime: _.now(), author: self.signedUserName};
    
                    let _rtn = fsHandler.fsNew(_type, self.rootPath, _name, null, _attr);
    
                    if(_rtn == 1){
                        self.load();
                    }
                },
                newFile() {
                    fileSystem.fileNew(this.rootPath,this.load);
                },
                onOrderCommand(cmd){
                    let command = JSON.parse(cmd);
                    this.model = _.orderBy(this.model,[command.prop],[command.type]);
                },
                info(node){
                    
                    let win = maxWindow.winInfo("属性",'<div id="fs-info"></div>',null, this.$refs.contentRef.$el);
    
                    new Vue({
                        delimiters: ['#{', '}#'],
                        data:{
                            model:node,
                            win: win
                        },
                        template:   `<mx-fs-info :node="model" :winContainer="win"></mx-fs-info>`,
                    }).$mount("#fs-info");
    
                },     
                moveTo(){
                    if(_.isEmpty(this.selectedItem)) {
                        this.$message({
                            type: "info",
                            message: "请选择移动内容"
                        })
                        return false;
                    }
                    const app = this.root;
                    let items = [];
                    _.forEach(this.selectedItem,(v)=>{
                        items.push(_.find(this.model,{id:v}));
                    })
                    fileSystem.fileMoveTo(app,items,this.load);
    
                },
                copyTo(){
                    
                    if(_.isEmpty(this.selectedItem)) {
                        this.$message({
                            type: "info",
                            message: "请选择复制内容"
                        })
                        return false;
                    }
                    
                    let items = [];
                    _.forEach(this.selectedItem,(v)=>{
                        items.push(_.find(this.model,{id:v}));
                    })

                    fileSystem.fileCopyTo(null,items,this.load);
    
                },
                deleteThem() {
                    
                    let items = [];
                    _.forEach(this.selectedItem,(v)=>{
                        items.push(_.find(this.model,{id:v}));
                    })
                    
                    _.forEach(items,(v)=>{
                        if(_.includes([['app','extend','assets','opt','script']],v.name)){
                            this.$message({
                                type: "info",
                                message: "系统目录，不允许删除!"
                            })
                            return false;
                        }
                    })
                    
    
                    if(_.isEmpty(this.selectedItem)) {
                        this.$message({
                            type: "info",
                            message: "选择需要删除的对象!"
                        })
                        return false;
                    }
    
                    const h = this.$createElement;
                    this.$msgbox({
                            title: `确定要删除选定文件?`,
                            message: h('span', null, _.concat(h('p', null, `目录：${this.rootPath}`),_.map(items,(v)=>{ return h('p', null, v.name); })) ),
                            showCancelButton: true,
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning',
                    }).then(() => {
                        _.forEach(items, (v)=>{
                            this.deleteIt(v, false);
                        })
                        
                    }).catch(()=>{

                    });

                },
                deleteIt(event, prompt) {
                    
                    if(_.includes(['admin','app','extend','assets','opt','script'],event.name)){
                        this.$message({
                            type: "info",
                            message: "系统目录，不允许删除!"
                        })
                        return false;
                    }
    
                    if(_.isEmpty(event)) {
                        this.$message({
                            type: "info",
                            message: "选择需要删除的对象!"
                        })
                        return false;
                    }
    
                    if(prompt){
                        
                        this.$confirm('确定要删除 ${event.name} 文件??', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                            }).then(() => {
                                let rtn = fsHandler.fsDelete(event.parent,event.name);
    
                                if (rtn == 1){
                                    this.load();
                                    this.$message({
                                        type: "success",
                                        message: "删除成功！"
                                    });
                                } else {
                                    this.$message({
                                        type: "error",
                                        message: "删除失败 " + rtn.message
                                    })
                                }

                            }).catch(() => {
                                
                            });
                        
                    } else {
    
                        let rtn = fsHandler.fsDelete(event.parent,event.name);
    
                        if (rtn == 1){
                            this.load();
                            this.$message({
                                type: "success",
                                message: "删除成功！"
                            })
                        } else {
                            this.$message({
                                type: "error",
                                message: "删除失败 " + rtn.message
                            })
                        }
                    }
    
                },
                shareIt(event){
                    const self = this
    
                    alertify.prompt("共享设置", function (e, str) {
                        // str is the input text
                        if (e) {
                            // user clicked "ok"
                        } else {
                            // user clicked "cancel"
                        }
                    }, "admin;");
                    $(".alertify-prompt .alertify-message").css('height','5vh');
                },
                deployIt(item){
                    const self = this
    
                    let wnd = maxWindow.winDeployApp( `<i class="fab fa-codepen"></i> 应用发布`, `<div id="fs-app-deploy"></div>`, null, 'content');
    
                    let form = {
                        delimiters: ['#{', '}#'],
                        template:   `<el-container><el-main><el-tabs v-model="activeName" ref="tabs">
                                        <el-tab-pane label="应用发布" name="app">
                                            <el-container style="height:100%;">
                                                <el-main style="height:100%;overflow:auto;padding:10px 0px;">
                                                    <el-form ref="form" :model="app" label-width="80px">
                                                        <el-form-item label="中文名">
                                                            <el-input v-model="app.cnname"></el-input>
                                                        </el-form-item>
                                                        <el-form-item label="英文名称">
                                                            <el-input v-model="app.enname"></el-input>
                                                        </el-form-item>
                                                        <el-form-item label="图标选择">
                                                            <el-button type="text" @click="activeName='icon'">
                                                                <el-avatar shape="square" fit="fill" size="64" :src="app.icon.value"></el-avatar>
                                                            </el-button>
                                                        </el-form-item>
                                                        <el-form-item label="Target">
                                                            <el-radio-group v-model="app.target">
                                                                <el-radio label="_blank">打开新窗口</el-radio>
                                                                <el-radio label="_parent">当前窗口打开</el-radio>
                                                            </el-radio-group>
                                                        </el-form-item>
                                                        <el-form-item label="分组">
                                                            <el-radio-group v-model="app.groups.group">
                                                                #{app.groups.group}#
                                                                <el-radio :label="item.name" v-for="item in model.groups">#{item.title}#</el-radio>
                                                            </el-radio-group>
                                                        </el-form-item>
                                                    </el-form> 
                                                </el-main>
                                                <el-footer style="height:40px;line-height:40px;text-align:right;">
                                                    <el-button type="primary" @click="deploy">发布</el-button>
                                                    <el-button type="defult" @click="cancel">取消</el-button>
                                                </el-footer>
                                            </el-container>
                                        </el-tab-pane>
                                        <el-tab-pane label="" name="icon">
                                            <el-container style="height:100%;">
                                                <el-main style="height:100%;overflow:auto;padding:10px 0px;">
                                                    <el-radio-group v-model="app.icon.value">
                                                        <el-radio :label="'/fs'+icon.parent+'/'+icon.name+'?type=download&issys=${window.SignedUser_IsAdmin}'" v-model="app.icon.value"  v-for="icon in app.icon.list">
                                                            <el-avatar shape="square" fit="contain" size="64" :src="icon | pickIcon"></el-avatar>    
                                                        </el-radio>
                                                    </el-radio-group>
                                                </el-main>
                                                <el-footer style="height:30px;line-height:30px;text-align:center;">
                                                    <el-button type="text" @click="activeName='app'">返回</el-button>  
                                                </el-footer>
                                            </el-container>
                                        </el-tab-pane>
                                    </el-tabs></el-main></el-container>`,
                        data: {
                            activeName: "app",
                            model: null,
                            app: {
                                cnname: _.head(item.name.split(".")),
								enname: _.head(item.name.split(".")),
                                seat: _.random(100, 10000),
                                url: "",
								icon: "",
								target: "_blank",
								selected: 1,
                                groups: {"group":"application"},
                                url: `/fs${[item.parent, item.name].join("/")}?issys=true&type=open&issys=${window.SignedUser_IsAdmin}`,
                                icon: {
                                    value: '',
                                    list: []
                                }                                
                            }
                        },
                        filters:{
                            pickIcon: function(icon) {
                                return `/fs${icon.parent}/${icon.name}?type=download&issys=${window.SignedUser_IsAdmin}`;
                            }
                        },
                        mounted: function() {
                            const me = this;
    
                            me.$nextTick(function() {
                                me.app.icon.value = `${window.ASSETS_ICON}/apps/png/creative.png?type=download&issys=${window.SignedUser_IsAdmin}`;
    
                                me.init();

                                _.delay(()=>{
                                    me.hideHeader();
                                },500)
                                
                            })
                        },
                        methods: {
                            init: function(){
                                const me = this;
                                me.model = fsHandler.callFsJScript("/matrix/apps/appList.js",null).message;
                                me.app.icon.list = fsHandler.fsList(`${window.ASSETS_ICON}/apps/png`);
    
                            },
                            hideHeader(){
                                const me = this;
                                me.$refs.tabs.$children[0].$el.style.display = 'none';
                            },
                            deploy: function(){
                                const me = this;
    
                                let check = fsHandler.callFsJScript("/matrix/apps/app_exist_check.js",encodeURIComponent(JSON.stringify(me.app.cnname))).message;;
    
                                if(check==1){
                                    me.$message({
                                        message:"应用已经发布，请确认。",
                                        type: "info"
                                    });
                                    return false;
                                }

                                _.extend(me.app,{
                                                    icon: me.app.icon.value.replace(/\/fs\/assets\/images\/apps\/png\//,'').replace(/\?type=download&issys=true/,'')
                                                });

                                let rtn = fsHandler.callFsJScript("/matrix/apps/app.js",encodeURIComponent(JSON.stringify(me.app)));
                                if( _.lowerCase(rtn.status) == "ok"){
                                    self.$message({
                                        type: "info",
                                        message: "应用发布成功"
                                    });
                                    
                                    eventHub.$emit("APP-REFRESH-EVENT");

                                    $("ul.nav").find("li>a[title='应用']").popover({
                                        container: "body",
                                        title: "",
                                        content: `${me.app.cnname} 应用发布成功！`
                                    }).popover('show');

                                    _.delay(function(){
                                        $("ul.nav").find("li>a[data-original-title='应用']").popover('destroy');
                                    },8000)

                                    wnd.close();

                                }
    
                                // let app = {
                                //     cnname: me.app.cnname,
                                //     enname: me.app.enname,
                                //     icon: me.app.icon.value.replace(/\/fs\/assets\/images\/apps\/png\//,'').replace(/\?type=download&issys=true/,''),
                                //     seat: me.app.seat,
                                //     url: me.app.url
                                // };
    
                                // let rtn = fsHandler.callFsJScript("/matrix/apps/app.js",encodeURIComponent(JSON.stringify(app)));
                                // if( _.lowerCase(rtn.status) == "ok"){
                                //     alertify.success("应用发布成功");
                                //     eventHub.$emit("APP-REFRESH-EVENT");
    
                                //     $("ul.nav").find("li>a[title='应用']").popover({
                                //         container: "body",
                                //         title: "",
                                //         content: `${me.app.cnname} 应用发布成功！`
                                //     }).popover('show');
    
                                //     _.delay(function(){
                                //         $("ul.nav").find("li>a[data-original-title='应用']").popover('destroy');
                                //     },8000)
    
    
                                //     wnd.close();
                                // }
                            },
                            cancel:function(){
                                wnd.close();
                            }
                        }
                    };
                    new Vue(form).$mount("#fs-app-deploy");
    
                },
                editIt(node){
                    
                    // 判断是否已有窗体打开
                    try {
                        if( window.jsPanel.activePanels.getPanel(`jsPanel-editor`) ){
                            window.jsPanel.activePanels.getPanel(`jsPanel-editor`).front();
                            window.editorApp.$refs.fsEditor.tabAdd(node);
                        } 
                    } catch(err){
                        // 打开窗体
                        let win = maxWindow.winEditor("M³ Devops", `<div id="fs-editor-template" style="width: 100%;height: 100%;"></div>`, null, null);
                        // vue组件实例化
                        window.editorApp = new Vue({
                            data: {
                                model: node,
                                root: this.root,
                                win: win
                            },  
                            template: `<mx-fs-editor :model="model" :root="this.root" :winContainer="win" ref="fsEditor"></mx-fs-editor>`
                        }).$mount(`#fs-editor-template`);
                        
                    } 
    
                },
                downloadIt(item, prompt) {
                    const self = this
    
                    if(item.ftype == 'dir'){
                        let rtn = fsHandler.fsList(item.parent);
    
    
                    } else {
    
                        /*if(_.includes(['zip','gz','tar','exe','png','gif','svg','doc','ppt','file'],item.ftype)){
                            let _url = `/fs/${item.parent}/${item.name}?type=download`.replace(/\/\//g,'/');
                            let _target = '_blank';
                            // system || extend || ...
                            if(_.startsWith(item.parent,'/extend') || _.startsWith(item.parent,'/script') || _.startsWith(item.parent,'/app')){
                                _url += '&issys=true';
                            }
                            window.open(_url, _target);
                        } else if(_.includes(['mp3','mp4'],item.ftype)){
                            let _url = `/fs/${item.parent}/${item.name}?type=download`.replace(/\/\//g,'/');
                            let _target = '_blank';
                            // system || extend || ...
                            if(_.startsWith(item.parent,'/extend') || _.startsWith(item.parent,'/script') || _.startsWith(item.parent,'/app')){
                                _url += '&issys=true';
                            }
                            window.location.href=_url;
                        } else {
                            let rtn = fsHandler.fsContent(item.parent, item.name);
                            let blob = new Blob([rtn], {type: "text/plain;charset=utf-8"});
    
                            saveAs(blob, `${item.name}`);
                        }*/
    
                        let _url = `/fs/${item.parent}/${item.name}?type=download&issys=${window.SignedUser_IsAdmin}`.replace(/\/\//g,'/');
                        let _target = '_blank';
                        // system || extend || ...
                        //if(_.startsWith(item.parent,'/extend') || _.startsWith(item.parent,'/script') || _.startsWith(item.parent,'/app')){
                        /*if(item.parent === "/"){
                            _url += '&issys=true';
                        }*/
                        window.open(_url, _target);
                    }
    
    
                },
                downloadThem(){
                    const self = this
    
                    let _them = $(".fs-node-highlight .list-context-menu");
    
                    if(_.isEmpty(_them)) {
                        alertify.log("选择需要下载的对象！");
                        return false;
                    }
    
                    let zip = new JSZip();
                    _.forEach(_them, function(v,k){
                        let item = $(v).data("item");
                        let rtn = fsHandler.fsContent(item.parent, item.name);
                        let blob = new Blob([rtn], {type: "text/plain;charset=utf-8"});
                        zip.file(`${item.name}`,rtn);
                    })
    
                    zip.generateAsync({type:"blob"})
                        .then(function(content) {
                            saveAs(content, `${self.rootPath}.zip`);
                        });
    
    
                },
                exportIt(path){
                    const self = this;
                    
                    alertify.confirm(`确认要导出 ${path} 目录下的所有文件?`, function (e) {
                        if (e) {
                            fsHandler.fsZip(path);
                            self.$message({
                                type: "info",
                                message: "导出操作将提交至后台，请稍后。。。"
                            })
                        } else {
                            
                        }
                    });
    
                },
                importIt(event) {
                    const self = this;
    
                    let file = event.target.files[0];
                    
                    alertify.confirm(`确认要导入 ${file.name} 文件，导入后将覆盖原有文件，请确认！<br><br>
                                        文件名称：${file.name}<br><br>
                                        修改时间：${file.lastModifiedDate}<br><br>
                                        文件大小：${mx.bytesToSize(file.size)}`, function (e) {
                        if (e) {
                            let rtn = fsHandler.fsUnZip(self.rootPath, file);

                            self.$message({
                                type: "info",
                                message: "导入操作将提交至后台，请稍后。。。"
                            })

                            if(rtn == 1){
                                self.load();
                            }
                        } else {
                            
                        }
    
                        event.target.value = null;
    
                    });
                },
                syncIt(){
                    const self = this
    
                    alertify.prompt("同步设置", function (e, str) {
                        // str is the input text
                        if (e) {
                            // user clicked "ok"
                        } else {
                            // user clicked "cancel"
                        }
                    }, "url:http://47.92.151.165/matrix/web.git;username:admin;password:admin;interval=24hour;");
                    $(".alertify-prompt .alertify-message").css('height','5vh');
                },
                selectAll(){
                    if(_.isEmpty(this.selectedItem)){
                        this.selectedItem = _.map(this.model,'id');
                    } else {
                        this.selectedItem = [];
                    }
                },
                setRootPath(item) {
                    const self = this;
                    
                    let _item = _.attempt(JSON.parse.bind(null, decodeURIComponent(window.atob(item))));
    
                    self.openIt(_item, [_item.parent,_item.name].join("/"));
    
                },
                toggleLeft() {
                    const self = this;
    
                    if(self.toggle.left) {
    
                        $("#nav").hide();
    
                        $("#content").removeClass("col-lg-10");
                        $("#content").addClass("col-lg-12");
    
                        $(".navtoggle").removeClass("fa fa-caret-left");
                        $(".navtoggle").addClass("fa fa-caret-right");
    
                        self.toggle.left = false;
                    } else {
                        $("#nav").slideDown(500);
                        $("#nav").show();
    
                        $("#content").removeClass("col-lg-12");
                        $("#content").addClass("col-lg-10");
                        //$("#content").find(".panel-default").css("border-left","2px #ddd dotted");
    
                        $(".navtoggle").removeClass("fa fa-caret-right");
                        $(".navtoggle").addClass("fa fa-caret-left");
    
                        self.toggle.left = true;
                    }
                }
            }
        
        }
        </script>
    
    
    
    </code>
    