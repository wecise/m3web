<!--

    [[[[[[[[[[[[[[[      ]]]]]]]]]]]]]]]
    [::::::::::::::      ::::::::::::::]
    [::::::::::::::      ::::::::::::::]
    [::::::[[[[[[[:      :]]]]]]]::::::]
    [:::::[                      ]:::::]
    [:::::[                      ]:::::]
    [:::::[                      ]:::::]
    [:::::[                      ]:::::]
    [:::::[    CODE BY WANGZD    ]:::::]
    [:::::[                      ]:::::]
    [:::::[                      ]:::::]
    [:::::[                      ]:::::]
    [:::::[                      ]:::::]
    [:::::[                      ]:::::]
    [::::::[[[[[[[:      :]]]]]]]::::::]
    [::::::::::::::      ::::::::::::::]
    [::::::::::::::      ::::::::::::::]
    [[[[[[[[[[[[[[[      ]]]]]]]]]]]]]]]

-->
{{template "base/head" .}}
<!-- zTree Core CSS -->
<link href="{{AppSubUrl}}/web/vendor/zTree/css/systemStyle/zTreeStyle.css" type="text/css" rel="stylesheet">

<style type="text/css">

    /* For Body */
    body{
        overflow:hidden;
    }

    /* For content */
    #content.content{
        padding: 0px 5px;
    }

    .page-header {
        margin: 0px 0px 5px 0px;
        font-size: 16px;
        color: #888888;
    }

    hr{
        margin-top: 10px;
        margin-bottom: 10px;
    }

    /* For Nav tabs style */
    .nav-tabs {
        background-color: rgb(255, 255, 255) !important;
        background-image: none!important;
        background-repeat: repeat-x;
        border-radius: 0px!important;
    }
    ul.nav-main > li.active {
        border-bottom: 2px solid rgb(3, 169, 244)!important;
    }

</style>

<div id="app"></div>

<!--zTree Core JS-->
<script src="{{AppSubUrl}}/web/vendor/zTree/js/jquery.ztree.core-3.5.js"></script>
<script src="{{AppSubUrl}}/web/vendor/zTree/js/jquery.ztree.excheck-3.5.js"></script>
<script src="{{AppSubUrl}}/web/vendor/zTree/js/jquery.ztree.exedit-3.5.js"></script>


<link rel="vc" href="{{AppSubUrl}}/web/component/ai/ai-robot-component.html"></link>

<link rel="vc" href="{{AppSubUrl}}/web/component/probe/probe-tree-component.html"></link>
<link rel="vc" href="{{AppSubUrl}}/web/component/probe/probe-dropdown-tree-component.html"></link>
<link rel="vc" href="{{AppSubUrl}}/web/component/probe/probe-card-component.html"></link>
<link rel="vc" href="{{AppSubUrl}}/web/component/probe/probe-list-datatables-component.html"></link>

<link rel="vc" href="{{AppSubUrl}}/web/component/policy/policy-list-datatables-component.html"></link>

<link rel="vc" href="{{AppSubUrl}}/web/component/log/log-list-datatables-component.html"></link>

<link rel="vc" href="{{AppSubUrl}}/web/component/script/script-list-datatables-component.html"></link>

<script src="{{AppSubUrl}}/web/vendor/jquery/jquery-migrate-1.1.0.min.js"></script>

<script src="{{AppSubUrl}}/web/css/color/apps.min.js"></script>

<SCRIPT type="text/javascript">

    'use static';

    VueLoader.onloaded(["ai-robot-component",
                        "probe-tree-component",
                        "probe-dropdown-tree-component",
                        "probe-card-component",
                        "probe-list-datatables-component",
                        "policy-list-datatables-component",
                        "log-list-datatables-component",
                        "script-list-datatables-component"],function() {


        moment.locale(`{{.Lang}}`);

        Vue.component("probe-view",{
            props: {
                model: Object
            },
            template: `<div class="row">
                            <div class="col-lg-2">
                                <probe-tree-component id="probe-tree" system="probe"></probe-tree-component>
                            </div>

                            <div class="col-lg-10 probe-container">
                                <h4 class="page-header"><i class="fas fa-angle-right"></i> 探针列表</h4 class="page-header">
                                <probe-card-component :model="model.summary"></probe-card-component>
                                <probe-list-datatables-component :model="model" id="probe-list-table"></probe-list-datatables-component>
                            </div>
                        </div>`
        });

        Vue.component("policy-view",{
            props: {
                model: Object
            },
            template: `<div class="row">
                            <div class="col-lg-2">
                                <probe-tree-component id="policy-tree" system="policy"></-tree-component>
                            </div>

                            <div class="col-lg-10 policy-container">
                                <h4 class="page-header"><i class="fas fa-angle-right"></i> 策略管理</h4 class="page-header">
                                <policy-list-datatables-component :model="model" id="policy-list-table"></policy-list-datatables-component>
                            </div>
                        </div>`
        });

        Vue.component("log-view",{
            props: {
                model: Object
            },
            template: `<div class="row">
                          <div class="col-lg-2">
                            <probe-tree-component id="log-tree" system="log"></-tree-component>
                          </div>

                          <div class="col-lg-10 log-container">
                            <h4 class="page-header"><i class="fas fa-angle-right"></i> 日志管理</h4 class="page-header">
                            <log-list-datatables-component :model="model" id="log-list-table"></log-list-datatables-component>
                          </div>
                       </div>`
        });

        Vue.component("script-view",{
            props: {
                model: Object
            },
            template: `<div class="row">
                            <div class="col-lg-2">
                                <probe-tree-component id="script-tree" system="script"></-tree-component>
                            </div>
                            <div class="col-lg-10 script-container">
                                <h4 class="page-header"><i class="fas fa-angle-right"></i> 脚本管理</h4 class="page-header">
                                <script-list-datatables-component :model="model" id="script-list-table"></script-list-datatables-component>
                            </div>
                        </div>`
        });

        $(function () {

            var appVue = new Vue({
                delimiters: ['${', '}'],
                el: "#app",
                template: "#app-template",
                data: {
                    probe: {},
                    policy: {},
                    log: {},
                    script: {}
                },
                created:function(){
                    let self = this;

                    eventHub.$on("PROBE-REFRESH-EVENT", self.initData);
                },
                mounted: function () {
                    let self = this;

                    self.$nextTick(function () {
                        
                        self.init();

                        _.delay(function(){
                            self.initPlug();
                        },3000)
                    })
                },
                methods: {
                    init: function () {
                        let self = this;

                        self.initData(['probe','policy','script','log']);
                    },
                    initPlug: function(){
                        let self = this;

                        /* enable tooltip for all A tag */
                        $("a").tooltip({
                            enable: true,
                            position: { my: "left+15 center", at: "right center" }
                        });

                        /* toggle tab trigger Echart resize */
                        $("a[data-toggle='tab']").on("shown.bs.tab",function(){
                            eventHub.$emit("COMPONENT-REDRAW-EVENT",null);
                        })
                    },
                    initData: function(event){
                        let self = this;

                        _.forEach(event,function(v){
                            window[v] = callFsJScript(`/probe/probe_summary_by_${v}.js`,'');

                            if(window[v].status == 'ok'){
                                self[v] = window[v].message;
                            } else {
                                self[v] = [];
                            }
                        })

                    }
                }
            })

        });


    })

</script>

<script type="text/x-template" id="app-template">

    <div id="content" class="content">
        <ul class="nav nav-tabs nav-main" role="tablist">
            <li class="active"><a href="#tab1" role="tab" data-toggle="tab">探针列表</a></li>
            <li><a href="#tab2" role="tab" data-toggle="tab">策略管理</a></li>
            <li><a href="#tab3" role="tab" data-toggle="tab">日志配置</a></li>
            <li><a href="#tab4" role="tab" data-toggle="tab">脚本管理</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade in active" id="tab1">
                <probe-view :model="probe"></probe-view>
            </div>
            <div class="tab-pane fade" id="tab2">
                <policy-view :model="policy"></policy-view>
            </div>
            <div class="tab-pane fade in" id="tab3">
                <log-view :model="log"></log-view>
            </div>
            <div class="tab-pane fade in" id="tab4">
                <script-view :model="script"></script-view>
            </div>
        </div>
    </div>

</script>


{{template "base/footer" .}}
